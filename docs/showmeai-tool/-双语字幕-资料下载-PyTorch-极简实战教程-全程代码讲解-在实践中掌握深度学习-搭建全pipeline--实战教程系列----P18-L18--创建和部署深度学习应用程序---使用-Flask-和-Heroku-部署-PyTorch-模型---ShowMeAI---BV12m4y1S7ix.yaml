- en: „ÄêÂèåËØ≠Â≠óÂπï+ËµÑÊñô‰∏ãËΩΩ„ÄëPyTorch ÊûÅÁÆÄÂÆûÊàòÊïôÁ®ãÔºÅÂÖ®Á®ã‰ª£Á†ÅËÆ≤Ëß£ÔºåÂú®ÂÆûË∑µ‰∏≠ÊéåÊè°Ê∑±Â∫¶Â≠¶‰π†&Êê≠Âª∫ÂÖ®pipelineÔºÅÔºúÂÆûÊàòÊïôÁ®ãÁ≥ªÂàóÔºû - P18ÔºöL18-
    ÂàõÂª∫ÂíåÈÉ®ÁΩ≤Ê∑±Â∫¶Â≠¶‰π†Â∫îÁî®Á®ãÂ∫è - ‰ΩøÁî® Flask Âíå Heroku ÈÉ®ÁΩ≤ PyTorch Ê®°Âûã - ShowMeAI - BV12m4y1S7ix
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: HeyÔºå guysÔºå welcomele to a new Pytorch tutorial Today„ÄÇ I show you how we can
    deploy our Pytorch model with flask and Heroku„ÄÇ We create a simple flask app with
    a rest API that returns the result as chasing data„ÄÇ And then we will deploy to
    Heroku„ÄÇ And as an exampleÔºå our Pytorch app should do diit classification„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: So at the endÔºå I show you how I draw my own ditits and then predict it with
    our life running app„ÄÇ So let's start„ÄÇ So first of allÔºå let's create a new directory„ÄÇ
    So let's call this Pytorch flask to„ÄÇüòäÔºåThen let's go into this directory„ÄÇ and then
    we want to create a new virtual environment„ÄÇ So we say Python 3„ÄÇüòäÔºåMinus MÔºå V N
    VÔºå N„ÄÇ And this will create a new virtual environment„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/a4f608f66d892f12b3640cd5547c24da_1.png)'
  prefs: []
  type: TYPE_IMG
- en: And by the wayÔºå this command might be slightly different on Windows„ÄÇ So for
    this„ÄÇ you can have a look at this installation guide from the official fl side„ÄÇ
    I will put the link in the description Here„ÄÇ you find all these instructions„ÄÇ![](img/a4f608f66d892f12b3640cd5547c24da_3.png)
  prefs: []
  type: TYPE_NORMAL
- en: So now we have our virtual environment and now we want to activate it by saying
    dot V and thin slash activate„ÄÇ And againÔºå this is different on Windows„ÄÇ And now
    we install the things we need„ÄÇ So we say Pip install flask„ÄÇ![](img/a4f608f66d892f12b3640cd5547c24da_5.png)
  prefs: []
  type: TYPE_NORMAL
- en: And then we install the packages for pieytorrch„ÄÇ So we say PipÔºå install torch
    and torch vision„ÄÇ Now„ÄÇ this will take a couple of seconds„ÄÇAl rightÔºå So now we
    have this„ÄÇ and now I create another directory and call this app„ÄÇ And then I open
    up my editor„ÄÇ So here I'm using visual studio code„ÄÇAnd„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/a4f608f66d892f12b3640cd5547c24da_7.png)'
  prefs: []
  type: TYPE_IMG
- en: Let me make this larger for you„ÄÇAnd now we see we have two directories„ÄÇ So this
    is the one with our virtual environmentÔºå and this is the new empty app directory„ÄÇ
    Now„ÄÇ inside the app directoryÔºå let's create a file main dot pi„ÄÇ And here we will
    write our flask app„ÄÇ So we say from flask import flask„ÄÇ Then we create a new„ÄÇ
    or by the wayÔºå yesÔºå I sayÔºå yes„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: I want to use the virtual end in here„ÄÇüòäÔºåÂóØ„ÄÇSoÔºå this one„ÄÇAnd now I create an app
    by saying app equals flask and then double underscore name„ÄÇ This is just the convention„ÄÇ
    how we do it„ÄÇ And then we only want to create one function„ÄÇ So one API and point„ÄÇ
    And we call this predict„ÄÇ And here we do our prediction later„ÄÇ And for now„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: we also have to decorate it by saying app dot route„ÄÇ And then the path to the
    URL„ÄÇ So here we say slash predict„ÄÇ And we want to say the methods„ÄÇ the allowed
    methods is only a post methods„ÄÇ So here we create a list and say post„ÄÇüòäÔºåNow„ÄÇ this
    is the„ÄÇA P I route that we need„ÄÇ And here what we want to do is we want to do
    four things„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: so we want to load an image„ÄÇWe want to or or get the image from our request„ÄÇThen
    we want to transform the image to a tensor„ÄÇThen we want to make our prediction„ÄÇ
    and then we want to return cha data„ÄÇ So the result as a cha data„ÄÇ So for this„ÄÇ
    we also need to import request from flask„ÄÇ and we also import Chasonify„ÄÇ So for
    now„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: let's do a simple return statement and return a dummy chasing data„ÄÇ So here
    we put in a dictionary„ÄÇ So as a keyÔºå let's say results„ÄÇ and then as a valueÔºå let's
    use one„ÄÇSo now we have this and now let's open the terminal inside hereÔºå and let's
    go into the app directory„ÄÇ And now in order to start flaskÔºå we have to set two
    environment variables„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: So I say export flask app equals the file nameÔºå main dot pi and export flask
    and equals development„ÄÇ This will give us hot reloading during the development
    process„ÄÇ And by the wayÔºå againÔºå on Windows„ÄÇ this is not export„ÄÇ So here you have
    to say set„ÄÇ and then this part„ÄÇAnd now we can say flask run„ÄÇ And this will start
    our flask app on local host port 5000„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: So now we have a live running app with this end point„ÄÇ So now let's test this„ÄÇ
    Let's create a new directory„ÄÇ and let's call this test and inside here„ÄÇ Let's
    create a file test dot pie„ÄÇüòäÔºåAnd for this„ÄÇWe use the requests module„ÄÇ So we say
    import requests„ÄÇ And I think I have to install this too„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: So let's quit the server for a second by using control C and then say Pip install
    requests„ÄÇSo now we have this„ÄÇ So now let's restart our flask app again„ÄÇAnd now
    here we want to send one post request to our to this URL„ÄÇ So we say requests dot
    post„ÄÇ And then the URL path„ÄÇ So we say H T T P colon slash slash„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: And then we can say local host port 5000„ÄÇ So this is the same as we are seeing
    here„ÄÇ And then we also have to say slash predict like we specified here slash
    predict„ÄÇAnd then„ÄÇ what we want to„ÄÇSent„ÄÇ So for nowÔºå we don't want to send anything„ÄÇSoÔºå
    let's say„ÄÇPrint the response dots text„ÄÇ This will print the actual cha data that
    we are returning here„ÄÇ So now„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: if I go to the„ÄÇOther terminal„ÄÇ And let's go inside the test folder and run Python
    test pi„ÄÇSo I have a typo hereÔºå local host 5000„ÄÇ Let's do it again„ÄÇ Let me clear
    this„ÄÇ And now let's run Python test„ÄÇ And then we see this is working„ÄÇ So we get
    the dictionary that we specified here„ÄÇ So our app is already working„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: and now let's do these four steps„ÄÇ And for thisÔºå we create another file and
    the same app directory„ÄÇ Let's create a file„ÄÇ and let's call this torch u dot P„ÄÇ
    And here we do our„ÄÇüòä„ÄÇImports from the torch library„ÄÇ So we say import torch„ÄÇ We
    import torch dot NÔºå NÔºå S andÔºå N„ÄÇÂóØ„ÄÇThen we also sayÔºå import torch„ÄÇVision„ÄÇDot transforms
    as transform forms„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: And we say from pill import image„ÄÇ So we will need this to convert our image
    to the Tenzor„ÄÇ And now before we go onÔºå let's have a look at the code that we
    are going to use„ÄÇ So for this„ÄÇ I have this in my Pytorch repository from my Pytoch
    beginner course and I will also put this link in the description„ÄÇ So here we are
    going to use the tutorial number 13„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: our basic feet forward neural net to do diit classification„ÄÇ And So let me open
    up this in a second editor„ÄÇ![](img/a4f608f66d892f12b3640cd5547c24da_9.png)
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/a4f608f66d892f12b3640cd5547c24da_10.png)'
  prefs: []
  type: TYPE_IMG
- en: '![](img/a4f608f66d892f12b3640cd5547c24da_11.png)'
  prefs: []
  type: TYPE_IMG
- en: '![](img/a4f608f66d892f12b3640cd5547c24da_12.png)'
  prefs: []
  type: TYPE_IMG
- en: So hereÔºå this is the exact same code that you can find and download on Gitth„ÄÇ
    And so now basically„ÄÇ we want to run this file and then save the model„ÄÇ So what
    we have to do down here at the very end„ÄÇ we want to say torch dot save„ÄÇ And then
    we want to save the model dot state dit„ÄÇAnd then the file name„ÄÇ So here we sayÔºå
    let's call this Mist underscore FFN dot PÔºå TÔºå H„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: And then we want to do one more thing„ÄÇ So here for our data set right nowÔºå I
    only have one transform„ÄÇ So transform dot to1zoa„ÄÇ And now let's use another transform
    here„ÄÇ So let's say transform equals transform dot co because we use more than
    one„ÄÇ And here as a list„ÄÇ We first of all do our to1or transform„ÄÇAnd then we also
    want to normalize it„ÄÇ So I say transforms„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: dot normalize„ÄÇAnd then hereÔºå I put in the„ÄÇMean and the standard deviation„ÄÇ And
    this is to go in as a tuple„ÄÇ So the mean is point„ÄÇ1Ôºå3Ôºå07„ÄÇ and then a comma„ÄÇ because
    this should be a tuple„ÄÇ And then as a standard deviationÔºå let's copy and paste
    this„ÄÇ And here we use point 30Ôºå8Ôºå1„ÄÇ So these are just the global means and the
    standard deviation from the Mnes data set„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: So this is given here„ÄÇ So just put in the same numbers here„ÄÇAnd now we use this
    transform here„ÄÇ And so you don't have to do this„ÄÇ but I just want to demonstrate
    that later in our inference„ÄÇ we want to apply the same two transforms„ÄÇSo now we
    use this and now we want to run the code and then save it at the end„ÄÇ So here
    I'm using a conda environment„ÄÇ So the same as I used in the in the„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: Tutial in the beginner course tutorial„ÄÇ So I say Connda activate„ÄÇ3conda activate
    pie torch„ÄÇAnd then let's take Python„ÄÇ And this file is number 13 feet forward
    at pi and then run it„ÄÇ And this will take a couple of seconds„ÄÇAlrightÔºå so now
    it's done„ÄÇ And you could see that our during our trainingÔºå the loss decreased„ÄÇ
    And at the end„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: we have this accuracy„ÄÇ So it's pretty good„ÄÇ And also in the same folder appearedÔºå
    this file here„ÄÇ So we want to copy this and then paste it into this directory
    here„ÄÇ So now„ÄÇWe can close this„ÄÇ and now we can start„ÄÇImplementing the pipeline
    here„ÄÇ So here we want to do three things„ÄÇ So we want to load our model„ÄÇ We want
    to have a function to transform an image to a tenzor with the same transformations
    that we've just seen„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: And then we want to have a function to predictÔºå to do the prediction„ÄÇ So„ÄÇ![](img/a4f608f66d892f12b3640cd5547c24da_14.png)
  prefs: []
  type: TYPE_NORMAL
- en: NowÔºå let's go back to the„ÄÇ![](img/a4f608f66d892f12b3640cd5547c24da_16.png)
  prefs: []
  type: TYPE_NORMAL
- en: ÂóØ„ÄÇOriginal code„ÄÇ And from thereÔºå we copy a few things„ÄÇ So we copy this part„ÄÇ
    We want to have the same model class„ÄÇ![](img/a4f608f66d892f12b3640cd5547c24da_18.png)
  prefs: []
  type: TYPE_NORMAL
- en: So let's paste it up hereÔºå and we need these parametersÔºå and we remove the two
    device calls„ÄÇ So for nowÔºå or in this tutorialÔºå we are only using the CPU„ÄÇ So now
    we need the input size„ÄÇ the hidden size and the number of classes„ÄÇ and we also
    get this from here„ÄÇ So we have„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/a4f608f66d892f12b3640cd5547c24da_20.png)'
  prefs: []
  type: TYPE_IMG
- en: '![](img/a4f608f66d892f12b3640cd5547c24da_21.png)'
  prefs: []
  type: TYPE_IMG
- en: '![](img/a4f608f66d892f12b3640cd5547c24da_22.png)'
  prefs: []
  type: TYPE_IMG
- en: These hyperparmeter„ÄÇ So let's copy them over here„ÄÇ![](img/a4f608f66d892f12b3640cd5547c24da_24.png)
  prefs: []
  type: TYPE_NORMAL
- en: ThenÔºå we create our model„ÄÇ![](img/a4f608f66d892f12b3640cd5547c24da_26.png)
  prefs: []
  type: TYPE_NORMAL
- en: And then we want to load the state stick„ÄÇ So by the way„ÄÇ you can also find this
    in my Github repo how we save and load a model„ÄÇ So this is tutorial number 17
    and here we can grab this part„ÄÇ So this is the recommended way„ÄÇ by the wayÔºå when
    we only save the state dit„ÄÇ So then we create our model from the class„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: and we load the state dit„ÄÇ and we also have to set it to evaluation mode„ÄÇ So
    this is very important„ÄÇ![](img/a4f608f66d892f12b3640cd5547c24da_28.png)
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/a4f608f66d892f12b3640cd5547c24da_29.png)'
  prefs: []
  type: TYPE_IMG
- en: And we also need the path„ÄÇ So the path equals„ÄÇ And then this is the file name
    here„ÄÇ So it's in the same directory„ÄÇ So we say amest underscore FFN dot PH„ÄÇ And
    by the way„ÄÇ if you trained on the GPÔºå then you must be careful„ÄÇ So„ÄÇ but you also
    find how you load it from a GP to the CPU then„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: So you have to specify the map location„ÄÇ and this is our CPU device„ÄÇ![](img/a4f608f66d892f12b3640cd5547c24da_31.png)
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/a4f608f66d892f12b3640cd5547c24da_32.png)'
  prefs: []
  type: TYPE_IMG
- en: So now we have this„ÄÇ So now we have our model„ÄÇAnd the next thing we want to
    do is define a function to transform„ÄÇ transform the imageÔºå and this will get image
    as raw bytes as an input„ÄÇ and then here we want to create a transform by saying
    transform equals„ÄÇ and then we grab the same thing as we are having here„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: So we want to have the same transformation steps as in our training„ÄÇ but we
    also want to or need to have some more here„ÄÇ So for now„ÄÇ this could also be a
    RGp image as an inputÔºå but we only want to have it as a grayscale like here when
    we are loading this Mnes data set„ÄÇ and this is in grayscale format„ÄÇ and it's also
    in exactly this size„ÄÇ So each image has„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/a4f608f66d892f12b3640cd5547c24da_34.png)'
  prefs: []
  type: TYPE_IMG
- en: '![](img/a4f608f66d892f12b3640cd5547c24da_35.png)'
  prefs: []
  type: TYPE_IMG
- en: '![](img/a4f608f66d892f12b3640cd5547c24da_36.png)'
  prefs: []
  type: TYPE_IMG
- en: '![](img/a4f608f66d892f12b3640cd5547c24da_37.png)'
  prefs: []
  type: TYPE_IMG
- en: 28 by 28 pixels„ÄÇ So we have to use these same values too„ÄÇ So we applied two
    more transforms„ÄÇ So we say transforms dot„ÄÇ and then we can use gray scale gray
    scale„ÄÇ And then here we can say the nu of output channels equals one because we
    only have want to have one output channel„ÄÇ And we also want to resize it„ÄÇ So we
    say transforms dot resize„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: And then as a tuple the size28 by 28„ÄÇ So now we have this„ÄÇ So let me format
    this a little bit nicer„ÄÇ![](img/a4f608f66d892f12b3640cd5547c24da_39.png)
  prefs: []
  type: TYPE_NORMAL
- en: So now this is our transform„ÄÇ and then we want to apply it„ÄÇ SoÔºå first of all„ÄÇ
    we want to create an imageÔºå a pillow image from the image bytes„ÄÇ And we can say
    image dot open„ÄÇ and then I O dot bysÔºå I O„ÄÇ and then our image bys„ÄÇ And for thisÔºå
    we need to importÔºå sorry„ÄÇImport I O„ÄÇ So to handle input out output streams„ÄÇAnd
    then we want to apply our transform and then can return it„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: So we say returnÔºå transformÔºå and then our image„ÄÇ And we also say unque„ÄÇUnsqueze
    0„ÄÇ So this will return a new tenzor and inserts a dimension of one at this position„ÄÇ
    because during draining„ÄÇ we have the number of batches on one axis„ÄÇ And now we
    only right now„ÄÇ we only have one image„ÄÇ So we have to add this axis and only have
    one sample in our batch„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: So now we have this„ÄÇ and now one more method is missing„ÄÇ So now we have to write
    a function to do the prediction„ÄÇ So we say define get„ÄÇPrediction„ÄÇ and this will
    get a image tensor as input„ÄÇ And now for thisÔºå we also can have a look„ÄÇ![](img/a4f608f66d892f12b3640cd5547c24da_41.png)
  prefs: []
  type: TYPE_NORMAL
- en: At the„ÄÇ![](img/a4f608f66d892f12b3640cd5547c24da_43.png)
  prefs: []
  type: TYPE_NORMAL
- en: Original code„ÄÇ And down here we do the evaluation„ÄÇ And here we use the same
    code„ÄÇ So let's copy and paste this„ÄÇ![](img/a4f608f66d892f12b3640cd5547c24da_45.png)
  prefs: []
  type: TYPE_NORMAL
- en: And here„ÄÇ So we resize our„ÄÇImage to be in this shape„ÄÇThen we can remove this
    part because we don't use GP U support„ÄÇThen we perform the forward pass„ÄÇ and then
    we get the prediction by calling torch dot max„ÄÇ and then we can return the predicted
    class or predicted index„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: And now this is all we need in this file„ÄÇ So now this is all the code for our
    inference„ÄÇAnd now we can go back to our main file and then import this„ÄÇ So we
    say from torch usÔºå we import„ÄÇLet's call it was called transform image and get
    prediction„ÄÇ So now in our predict method„ÄÇ we want to implement this pipeline„ÄÇ
    And here we want to be very careful because we don't want to have a error here„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: So then our server crashes„ÄÇ So we do some error checking„ÄÇ So first of all„ÄÇ we
    check if our request dot method equals equals post„ÄÇ And only then we do the code„ÄÇThen
    we get the file„ÄÇ So we later we pass a file to this post request„ÄÇ and then we
    get this file by saying file equals request dot fileÔºå dot get„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: And then we use the key file later„ÄÇ So now firstÔºå we check if file„ÄÇIs not or
    we say if file is none or file dot file name equal equals an empty string„ÄÇ Then
    we return chason file„ÄÇ And here we return a dictionary where we put in a arrow
    as key„ÄÇ And as a valueÔºå we say no file„ÄÇ So this is the first thing we check„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: Then we also check if this is an allowed extension„ÄÇ SoÔºå for example„ÄÇ we only
    support P and G and Jpe files„ÄÇ So we say if not allowed file„ÄÇ And then here we
    pass the file dot file name„ÄÇ Then we also return a error„ÄÇ So let's say return
    Chasoniffi„ÄÇ and then let's say formatÔºå not support„ÄÇTs„ÄÇAnd for this„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: we create a little helper function„ÄÇ So let's say define a allowed file„ÄÇ and
    this will get a file name„ÄÇ And then our file name could beÔºå for example„ÄÇ sum name
    and then dot P and GÔºå our ending„ÄÇ And now we want to define some allowed extensions„ÄÇ
    So let's say allowed extensions equals„ÄÇ And this is a set with only unique values„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: So we support P and G JpeEC and Jpeg with an E„ÄÇ So„ÄÇüòäÔºåAnd nowÔºå hereÔºå we return„ÄÇDot
    in file name„ÄÇ So our file name should be this format„ÄÇAnd alsoÔºå now we want to
    check the ending„ÄÇ So we want to split our file„ÄÇ So we say file name dot R split„ÄÇ
    So from the right side„ÄÇ and we want to split at the dot and only have maximum
    one split„ÄÇ and then we take the second part„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: So this part„ÄÇ So this is index one„ÄÇ Then we convert it to lower„ÄÇ And then we
    check if this is in our allowed extensions„ÄÇ So now„ÄÇThis will return true if our
    file name looksÔºå for exampleÔºå like this„ÄÇSo now down hereÔºå we can go on„ÄÇ And so
    now what we want to do is we want to load the image bys„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: then do the transformation and our prediction and this part„ÄÇ And for now„ÄÇ I
    wrap this in a try except block„ÄÇ So this is not very good error handling„ÄÇ But
    for now„ÄÇ this should be okay„ÄÇ So if we have a exception in this part„ÄÇ and we say
    error„ÄÇ and let's say error during„ÄÇÂóØ„ÄÇErrra during prediction„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: And then here we say our image bys equals file dot read„ÄÇThen we say our tenor
    equals transform image and put in the image bytes„ÄÇ Then we get the prediction„ÄÇ
    prediction equals get prediction with our tenor„ÄÇ and then we want to return the
    result S a„ÄÇChasten files„ÄÇ So we do„ÄÇ let's say our data equals a dictionary with
    the prediction key„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: And you'll use prediction prediction dot item because we cannot put a tenor
    in this„ÄÇ But our tenor only has one element„ÄÇ So we get this by saying prediction
    dot item„ÄÇAnd in case of the Mnes data sets of this„ÄÇFor exampleÔºå this has index
    0„ÄÇ and then this is equivalent to the number 0 that we have drawn„ÄÇ So basically„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: we also want to return the actual class name„ÄÇ but in this caseÔºå this is the
    same„ÄÇ So here we just do for demonstration„ÄÇ we return the same thing as a string„ÄÇ
    So string prediction dot„ÄÇItem„ÄÇSo hereÔºå for exampleÔºå if we would use the Cypher
    10 data set„ÄÇ then we would have to do a a mapping„ÄÇ SoÔºå for exampleÔºå index 0 is
    a car or a ship or whatever„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: So this is what you want to put in here„ÄÇ So now we have the data„ÄÇ And now we
    only have to return this as a cha object again„ÄÇ And then we should be done„ÄÇSo
    I think this is all we need„ÄÇ So now let's see„ÄÇ So our server should have reloaded
    automatically because we set the„ÄÇEnvironment to development„ÄÇSo now let's go to
    our test file„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: And here we want to put in the files to our post request„ÄÇ So we say files equals„ÄÇ
    And remember„ÄÇ this is a dictionary with the key file„ÄÇ And now we need a file„ÄÇ
    So for thisÔºå let's go to Google„ÄÇ And let's search for Mnist„ÄÇ![](img/a4f608f66d892f12b3640cd5547c24da_47.png)
  prefs: []
  type: TYPE_NORMAL
- en: Image„ÄÇ![](img/a4f608f66d892f12b3640cd5547c24da_49.png)
  prefs: []
  type: TYPE_NORMAL
- en: And let's go to images„ÄÇ andÔºå for example„ÄÇWhere is it„ÄÇLet's grab this image„ÄÇ
    So let's click on save image as„ÄÇAnd then I will save it as 7 and on my desktop„ÄÇ
    and then I will„ÄÇLet me quickly grab this and copy it into this folder„ÄÇ![](img/a4f608f66d892f12b3640cd5547c24da_51.png)
  prefs: []
  type: TYPE_NORMAL
- en: So now we see we have this image in the folder„ÄÇ So now we want to open this
    here„ÄÇ So here we say open and then the file name 7 dot P and G„ÄÇ And we want to
    open it in read binary mode„ÄÇSoÔºå now we have this„ÄÇSo nowÔºå again„ÄÇ let's go to our
    test file„ÄÇ and now we should get a result with 7 if everything is working correctly„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: So now let's do P test at pi and cross fingers„ÄÇ AndÔºå of course„ÄÇ it's not working
    And if we go and have a look at this terminal and we get a syntax error invalid
    syntax„ÄÇ So let's go back„ÄÇ And let's have a look„ÄÇ So here I missed a commaÔºå I guessÔºå
    So let's save this„ÄÇ And„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/a4f608f66d892f12b3640cd5547c24da_53.png)'
  prefs: []
  type: TYPE_IMG
- en: NowÔºå our server crashed„ÄÇ So we have to say last run„ÄÇAgain„ÄÇ and that's exactly
    why we want to be very careful in this method and do some error handling here„ÄÇSo
    now let's test this again„ÄÇ So let's clear this„ÄÇ And now let's sayÔºå ohÔºå sorry„ÄÇ
    this was the wrong one„ÄÇ So here I want to say„ÄÇPython test dot pi„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: And then we get error during prediction„ÄÇ So it's still not working„ÄÇ So for now„ÄÇLet's
    comment the„ÄÇTry block out and let's see whicharrow we are having„ÄÇSo now you could
    see why this is not the best error handling because we don't see what went wrong„ÄÇ
    So againÔºå our server started„ÄÇ So let's say Python test of pi again„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: And then name transforms is not defined„ÄÇ So againÔºå I am having a„ÄÇTypepo hereÔºå
    trans„ÄÇForms„ÄÇ sorry about that„ÄÇ So nowÔºå So now let's save this and„ÄÇLet's run it
    again„ÄÇTensor has no attribute on squeeze„ÄÇ So againÔºå a typo„ÄÇUnsque„ÄÇAnd againÔºå Python
    tester pi images image„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/a4f608f66d892f12b3640cd5547c24da_55.png)'
  prefs: []
  type: TYPE_IMG
- en: Cancel„ÄÇAnd now„ÄÇPythhen test a pie„ÄÇ and now it's finally working„ÄÇ So now we see
    that our flaskg is running and our pytorch model is doing the correct thing„ÄÇ So
    now I can add our try except block again„ÄÇ So let's in then this part and do our
    except block again„ÄÇüòä„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/a4f608f66d892f12b3640cd5547c24da_57.png)'
  prefs: []
  type: TYPE_IMG
- en: So now we can remove this„ÄÇAnd now let's test this with our own images„ÄÇ So I'm
    using paintbrush here„ÄÇAnd then I specify a new image with width and height is
    100 pixels„ÄÇ And nowÔºå for example„ÄÇ we want to be careful„ÄÇ We want to have the background
    in black„ÄÇSo I fill a background with black„ÄÇ and now I'm using a white pencil„ÄÇ
    And thenÔºå for exampleÔºå let's do a three here„ÄÇ and let's save this„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: As3 dot P and G„ÄÇ And then let me copy this inside the„ÄÇFolder here„ÄÇAnd now let's
    use this one„ÄÇ So let's use3 dot P and G„ÄÇ And let's go back and let's clear this„ÄÇAnd
    run it again„ÄÇ And we get the prediction is 3„ÄÇ SoÔºå yeahÔºå this is pretty nice„ÄÇ So
    now we have this„ÄÇ and now the only thing left to do is deploy it„ÄÇSo for thisÔºå
    we have to do a couple more things„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: So the first one is to use an actual web server that is suitable for production„ÄÇ
    And for this„ÄÇ we use Q unicorn„ÄÇ So I say Pip install Q unicorn„ÄÇThenÔºå in our„ÄÇBase
    folderÔºå we create a new file„ÄÇ and let's call this W S G I dot pi and move this
    to the base folder„ÄÇ And here we say from app„ÄÇDot main import app„ÄÇ And now we want
    to create a Heroku app from this„ÄÇ So for thisÔºå of course„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: you need to have a Heroku account and the heroroku command line face installed„ÄÇ
    So if you„ÄÇHaven't„ÄÇThen go to the official websiteÔºå Heroku dot com„ÄÇ And there you
    find the instructions„ÄÇ I already did this„ÄÇ So now I have to log in„ÄÇ So I say heroroku
    lock in minus I to do it in the terminal„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/a4f608f66d892f12b3640cd5547c24da_59.png)'
  prefs: []
  type: TYPE_IMG
- en: '![](img/a4f608f66d892f12b3640cd5547c24da_60.png)'
  prefs: []
  type: TYPE_IMG
- en: Then I have to put in my credentials and my password„ÄÇAnd now it says I'm locked
    in so I can clear this again„ÄÇ And now we want to create a new app by saying herorokuÔºå
    create„ÄÇ And then the name„ÄÇ So let's call this flask pieytorrch tutorial„ÄÇüòäÔºåThis
    will create a new Heroku app„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: And in order to test thisÔºå we can go to the„ÄÇBase directory again„ÄÇ And we need
    to do„ÄÇOne more thing we need to update our path names the same way as we are doing
    it here„ÄÇ So now app is our base package„ÄÇ So this folder here„ÄÇ So in the main file„ÄÇ
    we have to say from app dot torch us„ÄÇ And inside thisÔºå we have to modify our path„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: So this is now app dot Amnes F F N dot PÔºå TÔºå H„ÄÇSorryÔºå here it' app„ÄÇ slash this
    one„ÄÇAnd now we can test this by saying heroroku local„ÄÇ So this will start„ÄÇ how
    we first need to have the profile„ÄÇ So let's create a new„ÄÇProug fileÔºå sorryÔºå sorry„ÄÇ
    I want this in there„ÄÇTop directory again„ÄÇ So let's sayÔºå let's call this proc file„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: This is what we need for heroroku„ÄÇ And here we need to specify„ÄÇ We want to have
    one Web app„ÄÇ And we want to use Q unicorn with our new we at W S G I file as starting
    point and our app„ÄÇ So this is the syntax„ÄÇNowÔºå againÔºå we can test this by saying
    heroroku local„ÄÇAnd now this is working„ÄÇ So this is starting our G unicorn server
    on the same port„ÄÇ So now not our flask app is running„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: but our heroroku app is running locally„ÄÇ And again„ÄÇ though the server didn't
    change so we can again test this by saying Python test pi„ÄÇ So this is still working
    with our new correct path names„ÄÇ and now we can stop this„ÄÇ![](img/a4f608f66d892f12b3640cd5547c24da_62.png)
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/a4f608f66d892f12b3640cd5547c24da_63.png)'
  prefs: []
  type: TYPE_IMG
- en: And now„ÄÇI also want to create a„ÄÇRuntime dot T XÔºå T„ÄÇ And inside thisÔºå we specify
    our Python version„ÄÇ So now this is Python 3„ÄÇ8„ÄÇ3„ÄÇThenÔºå we also„ÄÇLet's clear this„ÄÇ
    We also need our requirements„ÄÇ And since we use PipÔºå we can say Pip freeze and
    then greater and then require U require dot T XÔºå T„ÄÇThis will write all of our
    requirements that we installed inside this package„ÄÇInside this T X T file„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: But we have to modify this because right now we are using the normal torch and
    torch vision„ÄÇ And this takes a lot of space„ÄÇ And this is too large for Heroku„ÄÇ
    So we have to use the CPU only version here„ÄÇ And for this„ÄÇ we can go to the official
    Pytorrch website and then have a look at the installation guide„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/a4f608f66d892f12b3640cd5547c24da_65.png)'
  prefs: []
  type: TYPE_IMG
- en: '![](img/a4f608f66d892f12b3640cd5547c24da_66.png)'
  prefs: []
  type: TYPE_IMG
- en: '![](img/a4f608f66d892f12b3640cd5547c24da_67.png)'
  prefs: []
  type: TYPE_IMG
- en: So here we use Pip as our package managerÔºå and we don't want kuta support„ÄÇ And
    so on Me„ÄÇ I actually use this command„ÄÇ but on Heroical„ÄÇ we have Linux„ÄÇ So we need
    this command„ÄÇ So we need to have plus CPU appended to our torch and torch vision„ÄÇ
    So we say plus CPU here and plus CPU hereÔºå and we also need this command„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/a4f608f66d892f12b3640cd5547c24da_69.png)'
  prefs: []
  type: TYPE_IMG
- en: '![](img/a4f608f66d892f12b3640cd5547c24da_70.png)'
  prefs: []
  type: TYPE_IMG
- en: '![](img/a4f608f66d892f12b3640cd5547c24da_71.png)'
  prefs: []
  type: TYPE_IMG
- en: And we can write it at the top of our requirements file„ÄÇ So heres„ÄÇ So now this
    will install only the CPU version on Heroku„ÄÇ And now in order to push this directory
    to heroroku„ÄÇ we need a git rappo„ÄÇ So we say git in it„ÄÇ Then I want to add a git
    ignore„ÄÇ So I create a new fileÔºå Git ignore„ÄÇ And for thisÔºå let's go„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: or let's GoogleÔºå let's say Python git ignore„ÄÇ And I think this will lead us
    to git up„ÄÇ And then here we can copy all of this„ÄÇ![](img/a4f608f66d892f12b3640cd5547c24da_73.png)
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/a4f608f66d892f12b3640cd5547c24da_74.png)'
  prefs: []
  type: TYPE_IMG
- en: And put it in our git ignore„ÄÇ And at the topÔºå I also put in the test folder„ÄÇ
    So I want to ignore this folder tool„ÄÇ So let me quickly check if I have everything
    that I want in the rapple now„ÄÇ So list looks good„ÄÇ So now we have all of this„ÄÇ
    So now we want to add this as a remote rapple for heroku„ÄÇ So we say heroku git
    colon remote minus a„ÄÇ And then our app name„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: So I think we called it flask minus pi„ÄÇ![](img/a4f608f66d892f12b3640cd5547c24da_76.png)
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/a4f608f66d892f12b3640cd5547c24da_77.png)'
  prefs: []
  type: TYPE_IMG
- en: Torch minus tutorial„ÄÇThis will add this as a remote dpo„ÄÇ and now we add all
    of our files„ÄÇ So we say git at dots and then git commit minus M„ÄÇ And let's say
    initial commits and and now we can push it„ÄÇ so we say git push Heroku master„ÄÇ
    This will push all to HerokuÔºå and then start building and deploying the app„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: So now this takes a couple of seconds„ÄÇAll rightÔºå so this was successful„ÄÇ And
    now it' set deployed it to this URL„ÄÇ So here at this pathÔºå we now have our live
    running F„ÄÇ So now let's go back to the test dot pi„ÄÇ And instead of the local hostÔºå
    we use this URL„ÄÇ and then slash predict„ÄÇüòä„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/a4f608f66d892f12b3640cd5547c24da_79.png)'
  prefs: []
  type: TYPE_IMG
- en: And then let's go back to our test file„ÄÇ and let's run Python test again„ÄÇ And
    now we get the results„ÄÇ SoÔºå yeahÔºå so this is working„ÄÇ So now let's do one more
    test„ÄÇ So againÔºå let's use my paint program„ÄÇ And as a backgroundÔºå we have black„ÄÇ
    And now let's drawÔºå for exampleÔºå a8 like this„ÄÇ And let's save it as„ÄÇüòä„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/a4f608f66d892f12b3640cd5547c24da_81.png)'
  prefs: []
  type: TYPE_IMG
- en: 8 dot PÔºå N G„ÄÇ And then let's move it into this folder„ÄÇ And here let's use this„ÄÇ8
    dot P and G„ÄÇ And againÔºå save it and clear this and run it again„ÄÇAnd we see we
    get the prediction is 8„ÄÇ So this is working„ÄÇ And we have a life running app deployed
    to heroroku„ÄÇAnd yeah„ÄÇ I hope you enjoyed this tutorial„ÄÇ If you like this„ÄÇ
  prefs: []
  type: TYPE_NORMAL
- en: please subscribe to the channel and leave me a like and see you next timeÔºå bye„ÄÇüòä„ÄÇ![](img/a4f608f66d892f12b3640cd5547c24da_83.png)
  prefs: []
  type: TYPE_NORMAL
