- en: ã€åŒè¯­å­—å¹•+èµ„æ–™ä¸‹è½½ã€‘PyTorch æç®€å®æˆ˜æ•™ç¨‹ï¼å…¨ç¨‹ä»£ç è®²è§£ï¼Œåœ¨å®è·µä¸­æŒæ¡æ·±åº¦å­¦ä¹ &æ­å»ºå…¨pipelineï¼ï¼œå®æˆ˜æ•™ç¨‹ç³»åˆ—ï¼ - P17ï¼šL17-
    ä¿å­˜å’ŒåŠ è½½æ¨¡å‹ - ShowMeAI - BV12m4y1S7ix
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ã€åŒè¯­å­—å¹•+èµ„æ–™ä¸‹è½½ã€‘PyTorch æç®€å®æˆ˜æ•™ç¨‹ï¼å…¨ç¨‹ä»£ç è®²è§£ï¼Œåœ¨å®è·µä¸­æŒæ¡æ·±åº¦å­¦ä¹ &æ­å»ºå…¨pipelineï¼ï¼œå®æˆ˜æ•™ç¨‹ç³»åˆ—ï¼ - P17ï¼šL17-
    ä¿å­˜å’ŒåŠ è½½æ¨¡å‹ - ShowMeAI - BV12m4y1S7ix
- en: Heyï¼Œ guysï¼Œ welcome to a new Pytorch tutorial Todayã€‚ I want to show you how we
    can save and load our modelã€‚ I will show you the different methods and safe options
    you have to knowã€‚ And also what you have to consider when you are using a GP Uã€‚
    So let's startã€‚
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: å˜¿ï¼Œå¤§å®¶ï¼Œæ¬¢è¿æ¥åˆ°æ–°çš„Pytorchæ•™ç¨‹ã€‚ä»Šå¤©æˆ‘æƒ³å±•ç¤ºå¦‚ä½•ä¿å­˜å’ŒåŠ è½½æˆ‘ä»¬çš„æ¨¡å‹ã€‚æˆ‘ä¼šå±•ç¤ºä½ å¿…é¡»çŸ¥é“çš„ä¸åŒæ–¹æ³•å’Œä¿å­˜é€‰é¡¹ï¼Œä»¥åŠåœ¨ä½¿ç”¨GPUæ—¶éœ€è¦è€ƒè™‘çš„äº‹é¡¹ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å¼€å§‹å§ã€‚
- en: These are the only three different methods you have to rememberã€‚ So we have
    torch dot safeã€‚ then torch dot load and model dot load state ditã€‚ğŸ˜Šï¼ŒAnd these are
    all the methods we must rememberã€‚ and I will show you all of them in detailã€‚ So
    Torch dot Sa here can use tenor models or any dictionary as parameter for savingã€‚
    So you should know here that we can save any dictionary with itã€‚
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ä¸‰ç§ä¸åŒçš„æ–¹æ³•ä½ å¿…é¡»è®°ä½ã€‚æ‰€ä»¥æˆ‘ä»¬æœ‰torch.dot.safeï¼Œæ¥ç€æ˜¯torch.dot.loadå’Œmodel.dot.load.state_ditã€‚ğŸ˜Šè¿™äº›éƒ½æ˜¯æˆ‘ä»¬å¿…é¡»è®°ä½çš„æ–¹æ³•ï¼Œæˆ‘ä¼šè¯¦ç»†å±•ç¤ºæ‰€æœ‰è¿™äº›æ–¹æ³•ã€‚torch.dot.Saè¿™é‡Œå¯ä»¥ä½¿ç”¨tensoræ¨¡å‹æˆ–ä»»ä½•å­—å…¸ä½œä¸ºä¿å­˜å‚æ•°ã€‚æ‰€ä»¥ä½ åº”è¯¥çŸ¥é“æˆ‘ä»¬å¯ä»¥ç”¨å®ƒä¿å­˜ä»»ä½•å­—å…¸ã€‚
- en: And I will show you how we can use this later in our training pipelineã€‚ğŸ˜Šã€‚So
    torch doa then makes use of Python's pickle module to serialize the objects and
    saves themã€‚ So the result is serialized and not human readableã€‚And now for saving
    our modelã€‚ we have two optionsã€‚ The first one is the lazy methodã€‚ So we just call
    torch do save on our modelã€‚
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä¼šå±•ç¤ºå¦‚ä½•åœ¨è®­ç»ƒç®¡é“ä¸­åç»­ä½¿ç”¨è¿™äº›ã€‚ğŸ˜Šæ‰€ä»¥torch doaç„¶ååˆ©ç”¨Pythonçš„pickleæ¨¡å—æ¥åºåˆ—åŒ–å¯¹è±¡å¹¶ä¿å­˜å®ƒä»¬ã€‚ç»“æœæ˜¯åºåˆ—åŒ–çš„ï¼Œä¸å¯è¯»ã€‚è€Œç°åœ¨ä¿å­˜æˆ‘ä»¬çš„æ¨¡å‹ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§é€‰æ‹©ã€‚ç¬¬ä¸€ç§æ˜¯æ‡’æƒ°çš„æ–¹æ³•ã€‚æˆ‘ä»¬åªéœ€åœ¨æ¨¡å‹ä¸Šè°ƒç”¨torch.do.saveã€‚
- en: and we also have to specify the path or the file nameã€‚ And then laterã€‚ when
    we want to load our modelï¼Œ we just set up our model by saying model equals torch
    do load and then the file name againã€‚ And then we also want to set our model to
    evaluation methodã€‚ So by saying model do evilã€‚ So this is the lazy optionã€‚ and
    the disadvantage of this approach is that the serialized data is bound to the
    specific classes and the exact directory structure that is used when the model
    is savedã€‚
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬è¿˜å¿…é¡»æŒ‡å®šè·¯å¾„æˆ–æ–‡ä»¶åã€‚ç„¶åï¼Œå½“æˆ‘ä»¬æƒ³åŠ è½½æ¨¡å‹æ—¶ï¼Œåªéœ€è®¾ç½®æ¨¡å‹ï¼Œæ–¹æ³•æ˜¯modelç­‰äºtorch.do.loadï¼Œå†åŠ ä¸Šæ–‡ä»¶åã€‚æ¥ç€ï¼Œæˆ‘ä»¬è¿˜æƒ³å°†æ¨¡å‹è®¾ç½®ä¸ºè¯„ä¼°æ¨¡å¼ï¼Œæ‰€ä»¥å¯ä»¥è¯´model.do.evilã€‚è¿™æ˜¯æ‡’æƒ°çš„æ–¹æ³•ï¼Œè¿™ç§æ–¹æ³•çš„ç¼ºç‚¹æ˜¯åºåˆ—åŒ–æ•°æ®ä¸æ¨¡å‹ä¿å­˜æ—¶ä½¿ç”¨çš„ç‰¹å®šç±»å’Œç¡®åˆ‡ç›®å½•ç»“æ„ç»‘å®šåœ¨ä¸€èµ·ã€‚
- en: So there is a second optionï¼Œ which is the recommended way of saving our modelã€‚ğŸ˜Šã€‚![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_1.png)
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: è¿˜æœ‰ç¬¬äºŒä¸ªé€‰é¡¹ï¼Œè¿™æ˜¯æ¨èçš„ä¿å­˜æ¨¡å‹æ–¹å¼ã€‚ğŸ˜Š![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_1.png)
- en: If we just want to save our modelï¼Œ our trained model and use it later for interferenceã€‚
    then it is enough to only save the parametersã€‚ And as you should rememberã€‚ we
    can save any dictionary with torchaã€‚So we can save the parameters by calling torch
    dot save and then model dot state diã€‚ So this holds the parameters and then the
    pathã€‚And then laterã€‚
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœæˆ‘ä»¬åªæƒ³ä¿å­˜æˆ‘ä»¬çš„æ¨¡å‹ã€è®­ç»ƒå¥½çš„æ¨¡å‹ï¼Œå¹¶åœ¨ä¹‹åè¿›è¡Œæ¨ç†ï¼Œé‚£ä¹ˆåªéœ€ä¿å­˜å‚æ•°å³å¯ã€‚ä½ åº”è¯¥è®°å¾—ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨torchaä¿å­˜ä»»ä½•å­—å…¸ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨torch.dot.saveï¼Œç„¶åmodel.dot.state_diæ¥ä¿å­˜å‚æ•°ã€‚å› æ­¤ï¼Œè¿™é‡ŒæŒæœ‰å‚æ•°å’Œè·¯å¾„ï¼Œç„¶ååœ¨ä¹‹åä½¿ç”¨ã€‚
- en: when we want to load our model again firstï¼Œ we have to create the model objectã€‚
    and then we call model dot load state ditã€‚ And then inside thisã€‚ we call torch
    dot load pathã€‚ So be careful here since load state di doesn't take a only a pathã€‚
    but instead it takes the loaded dictionary yearã€‚ And then againã€‚
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: å½“æˆ‘ä»¬æƒ³å†æ¬¡åŠ è½½æ¨¡å‹æ—¶ï¼Œé¦–å…ˆå¿…é¡»åˆ›å»ºæ¨¡å‹å¯¹è±¡ï¼Œç„¶åè°ƒç”¨model.dot.load.state_ditã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬è°ƒç”¨torch.dot.loadè·¯å¾„ã€‚æ³¨æ„ï¼Œload.state_diä¸ä»…æ¥å—è·¯å¾„ï¼Œè¿˜æ¥å—åŠ è½½çš„å­—å…¸å¹´ã€‚
- en: we set our model to evaluation modeã€‚ So this is the preferred way that you should
    rememberã€‚ And now let's jump to the code to see the different saving ways in practiceã€‚![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_3.png)
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å°†æ¨¡å‹è®¾ç½®ä¸ºè¯„ä¼°æ¨¡å¼ã€‚è¿™æ˜¯ä½ åº”è¯¥è®°ä½çš„é¦–é€‰æ–¹å¼ã€‚ç°åœ¨è®©æˆ‘ä»¬è·³åˆ°ä»£ç ä¸­ï¼Œçœ‹çœ‹å®è·µä¸­çš„ä¸åŒä¿å­˜æ–¹å¼ã€‚![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_3.png)
- en: So here I have a little script where I defined a small model class and here
    I created our model and now let me show you the lazy method firstã€‚ So first we
    define our file name so we say file equals and let's call this model do p So it's
    come and practice to use the ending dot p so short for pytorrch and then we save
    the whole model by saying torch do save and then model and the file So let's save
    this and let's run the script So let's say Python save load do pi and now if we
    open up our browser So we can ignore this warning here then we see here we have
    the model do pã€‚
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è¿™é‡Œæˆ‘æœ‰ä¸€ä¸ªå°è„šæœ¬ï¼Œå…¶ä¸­æˆ‘å®šä¹‰äº†ä¸€ä¸ªå°æ¨¡å‹ç±»ï¼Œåœ¨è¿™é‡Œæˆ‘åˆ›å»ºäº†æˆ‘ä»¬çš„æ¨¡å‹ï¼Œç°åœ¨è®©æˆ‘å…ˆç»™ä½ å±•ç¤ºæ‡’æƒ°çš„æ–¹æ³•ã€‚æ‰€ä»¥é¦–å…ˆæˆ‘ä»¬å®šä¹‰æˆ‘ä»¬çš„æ–‡ä»¶åï¼Œæ‰€ä»¥æˆ‘ä»¬è¯´æ–‡ä»¶ç­‰äºï¼Œè®©æˆ‘ä»¬ç§°ä¹‹ä¸ºæ¨¡å‹do
    pï¼Œæ‰€ä»¥å®ƒæ˜¯ä¸ªå¥½ä¹ æƒ¯ä½¿ç”¨ç»“å°¾.dot pï¼Œç¼©å†™ä¸ºpytorchã€‚ç„¶åæˆ‘ä»¬é€šè¿‡è¯´`torch.save`æ¥ä¿å­˜æ•´ä¸ªæ¨¡å‹ï¼Œç„¶åæ˜¯æ¨¡å‹å’Œæ–‡ä»¶ã€‚æ‰€ä»¥è®©æˆ‘ä»¬ä¿å­˜è¿™ä¸ªå¹¶è¿è¡Œè„šæœ¬ã€‚æ‰€ä»¥æˆ‘ä»¬è¯´Python
    save load do piï¼Œç°åœ¨å¦‚æœæˆ‘ä»¬æ‰“å¼€æµè§ˆå™¨ï¼Œæˆ‘ä»¬å¯ä»¥å¿½ç•¥è¿™ä¸ªè­¦å‘Šï¼Œç„¶åæˆ‘ä»¬çœ‹åˆ°æˆ‘ä»¬æœ‰æ¨¡å‹do pã€‚
- en: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_5.png)'
  id: totrans-10
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_5.png)'
- en: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_6.png)'
  id: totrans-11
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_6.png)'
- en: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_7.png)'
  id: totrans-12
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_7.png)'
- en: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_8.png)'
  id: totrans-13
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_8.png)'
- en: In the Experã€‚![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_10.png)
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨Experã€‚![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_10.png)
- en: And if we open thisï¼Œ then we see that this is some serialase dataï¼Œ so this is
    not human readableã€‚And now if we go back to our codeã€‚ So let's load our model
    so we can comment this outã€‚ and we also can comment this outã€‚![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_12.png)
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœæˆ‘ä»¬æ‰“å¼€è¿™ä¸ªï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°è¿™æ˜¯ä¸€éƒ¨åˆ†åºåˆ—åŒ–æ•°æ®ï¼Œå› æ­¤è¿™æ˜¯ä¸å¯è¯»çš„ã€‚ç°åœ¨å¦‚æœæˆ‘ä»¬å›åˆ°æˆ‘ä»¬çš„ä»£ç ã€‚æˆ‘ä»¬åŠ è½½æˆ‘ä»¬çš„æ¨¡å‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ³¨é‡Šæ‰è¿™ä¸ªã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥æ³¨é‡Šæ‰è¿™ä¸ªã€‚![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_12.png)
- en: And then we can load our model by sayingï¼Œ model equalsã€‚Equals torch dot loadã€‚
    and then the fileã€‚ And then rememberï¼Œ we want to set it to evaluation methodã€‚So
    we say model dot evilã€‚ and then we can use our modelã€‚ For exampleï¼Œ we can inspect
    the parametersã€‚ So let's say for Para in model dot parametersã€‚
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶åæˆ‘ä»¬å¯ä»¥é€šè¿‡è¯´ï¼Œæ¨¡å‹ç­‰äºæ¥åŠ è½½æˆ‘ä»¬çš„æ¨¡å‹ã€‚ç­‰äº`torch.load`ï¼Œç„¶åæ˜¯æ–‡ä»¶ã€‚ç„¶åè®°ä½ï¼Œæˆ‘ä»¬æƒ³è¦è®¾ç½®ä¸ºè¯„ä¼°æ¨¡å¼ã€‚æ‰€ä»¥æˆ‘ä»¬è¯´æ¨¡å‹.dot evilã€‚ç„¶åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æˆ‘ä»¬çš„æ¨¡å‹ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥æ£€æŸ¥å‚æ•°ã€‚æ‰€ä»¥æˆ‘ä»¬å‡è®¾å¯¹äºParaåœ¨æ¨¡å‹çš„å‚æ•°ä¸­ã€‚
- en: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_14.png)'
  id: totrans-17
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_14.png)'
- en: And thenï¼Œ let's print our Paraã€‚And save thisã€‚ And let'sã€‚Clear this and run our
    script againã€‚![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_16.png)
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶åï¼Œè®©æˆ‘ä»¬æ‰“å°æˆ‘ä»¬çš„Paraã€‚å¹¶ä¿å­˜è¿™ä¸ªã€‚ç„¶åè®©æˆ‘ä»¬æ¸…é™¤è¿™ä¸ªå¹¶å†æ¬¡è¿è¡Œæˆ‘ä»¬çš„è„šæœ¬ã€‚![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_16.png)
- en: And let me make this larger for youã€‚ So now if we run our script againã€‚ then
    we can see that we loaded our model and we can use the parametersã€‚So this is the
    lazy optionã€‚ And nowï¼Œ let me show you the preferred way of doing thisã€‚ So instead
    of just saying torch dot save model here and what we instead want to do is to
    say torch dot saveã€‚
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: è®©æˆ‘æŠŠè¿™ä¸ªæ”¾å¤§ç»™ä½ çœ‹ã€‚æ‰€ä»¥ç°åœ¨å¦‚æœæˆ‘ä»¬å†æ¬¡è¿è¡Œæˆ‘ä»¬çš„è„šæœ¬ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åŠ è½½äº†æ¨¡å‹å¹¶å¯ä»¥ä½¿ç”¨å‚æ•°ã€‚æ‰€ä»¥è¿™æ˜¯æ‡’æƒ°é€‰é¡¹ã€‚ç°åœ¨ï¼Œè®©æˆ‘ç»™ä½ å±•ç¤ºåšè¿™ä»¶äº‹çš„é¦–é€‰æ–¹å¼ã€‚æ‰€ä»¥ä¸æ˜¯ä»…ä»…è¯´`torch.save
    model`ï¼Œè€Œæ˜¯æˆ‘ä»¬æƒ³è¦åšçš„æ˜¯è¯´`torch.save`ã€‚
- en: and then we want to save the state ditã€‚ So here we have our model againã€‚ And
    then we say torch dot model dotã€‚![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_18.png)
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶åæˆ‘ä»¬æƒ³è¦ä¿å­˜çŠ¶æ€å­—å…¸ã€‚æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å†æ¬¡æœ‰æˆ‘ä»¬çš„æ¨¡å‹ã€‚ç„¶åæˆ‘ä»¬è¯´`torch.model.`ã€‚![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_18.png)
- en: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_19.png)'
  id: totrans-21
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_19.png)'
- en: Tarch dotafe model dot stateã€‚State diicedã€‚And thenï¼Œ let's run thisã€‚Soï¼Œ let me
    clear thisã€‚And let's open up the Explorer and delete this file hereã€‚![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_21.png)
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: '`torch.save model.state dict`ã€‚ç„¶åï¼Œè®©æˆ‘ä»¬è¿è¡Œè¿™ä¸ªã€‚æ‰€ä»¥ï¼Œè®©æˆ‘æ¸…é™¤è¿™ä¸ªã€‚ç„¶åæ‰“å¼€èµ„æºç®¡ç†å™¨ï¼Œåˆ é™¤è¿™ä¸ªæ–‡ä»¶ã€‚![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_21.png)'
- en: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_22.png)'
  id: totrans-23
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_22.png)'
- en: And now if we run our script againï¼Œ then we again have the fileã€‚ But now here
    it only save the state dictatesã€‚ And now if we want to load our model againã€‚ we
    first have to define itã€‚![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_24.png)
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨å¦‚æœæˆ‘ä»¬å†æ¬¡è¿è¡Œè„šæœ¬ï¼Œé‚£ä¹ˆæˆ‘ä»¬åˆæœ‰æ–‡ä»¶ã€‚ä½†ç°åœ¨å®ƒåªä¿å­˜çŠ¶æ€å­—å…¸ã€‚ç°åœ¨å¦‚æœæˆ‘ä»¬æƒ³è¦å†æ¬¡åŠ è½½æ¨¡å‹ï¼Œæˆ‘ä»¬é¦–å…ˆå¿…é¡»å®šä¹‰å®ƒã€‚![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_24.png)
- en: So let's call this loaded modelã€‚Loaded modelã€‚Equalsã€‚ and then let's also say
    the model and the number of input features is the sameã€‚ So it's 6ã€‚ And then we
    call loaded model dot load state diã€‚ And inside thisã€‚ Rememberã€‚ we have to call
    torch dot loadã€‚ and then the file nameã€‚ And then againã€‚
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: æ‰€ä»¥è®©æˆ‘ä»¬ç§°è¿™ä¸ªä¸ºåŠ è½½çš„æ¨¡å‹ã€‚åŠ è½½çš„æ¨¡å‹ã€‚ç­‰äºã€‚ç„¶åæˆ‘ä»¬è¿˜è¯´æ¨¡å‹å’Œè¾“å…¥ç‰¹å¾çš„æ•°é‡æ˜¯ç›¸åŒçš„ã€‚æ‰€ä»¥æ˜¯6ã€‚ç„¶åæˆ‘ä»¬è°ƒç”¨åŠ è½½çš„æ¨¡å‹.dot load state
    dictã€‚åœ¨é‡Œé¢ã€‚è®°ä½ï¼Œæˆ‘ä»¬å¿…é¡»è°ƒç”¨`torch.load`ï¼Œç„¶åæ˜¯æ–‡ä»¶åã€‚ç„¶åå†æ¬¡ã€‚
- en: we set our loaded model to evaluation modeã€‚![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_26.png)
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å°†åŠ è½½çš„æ¨¡å‹è®¾ç½®ä¸ºè¯„ä¼°æ¨¡å¼ã€‚![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_26.png)
- en: And then if we run thisï¼Œ So let's print the parameterss of the loaded modelã€‚
    And up hereã€‚ let's also print the parameterss of our normal modelã€‚![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_28.png)
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶åå¦‚æœæˆ‘ä»¬è¿è¡Œè¿™ä¸ªï¼Œæ‰€ä»¥è®©æˆ‘ä»¬æ‰“å°åŠ è½½æ¨¡å‹çš„å‚æ•°ã€‚å†ä¸Šé¢ï¼Œ*è®©æˆ‘ä»¬ä¹Ÿæ‰“å°ä¸€ä¸‹æˆ‘ä»¬æ­£å¸¸æ¨¡å‹çš„å‚æ•°*ã€‚![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_28.png)
- en: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_29.png)'
  id: totrans-28
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_29.png)'
- en: So thisï¼Œ if we don't do any training hereï¼Œ Then our model is still initialized
    with some random parametersã€‚ So let's run the script and let's check if the parameters
    are the sameã€‚![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_31.png)
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: æ‰€ä»¥å¦‚æœæˆ‘ä»¬åœ¨è¿™é‡Œä¸è¿›è¡Œä»»ä½•è®­ç»ƒï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„æ¨¡å‹ä»ç„¶ä¼šåˆå§‹åŒ–ä¸ºä¸€äº›éšæœºå‚æ•°ã€‚æ‰€ä»¥è®©æˆ‘ä»¬è¿è¡Œè„šæœ¬ï¼Œæ£€æŸ¥å‚æ•°æ˜¯å¦ç›¸åŒã€‚![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_31.png)
- en: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_32.png)'
  id: totrans-30
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_32.png)'
- en: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_33.png)'
  id: totrans-31
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_33.png)'
- en: So hereï¼Œ yeahï¼Œ we see that it workedã€‚ and it first printed the parameters of
    the model of the normal modelã€‚ and then here of the loaded modelã€‚ So these are
    the sameã€‚ So we see we have a tenzo with the weightsã€‚ and we also have a tenzo
    with the biasã€‚ and this is the same for both of our modelã€‚ So we see that this
    workedï¼Œ tooã€‚ So yeahï¼Œ againã€‚
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: æ‰€ä»¥åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬çœ‹åˆ°å®ƒæˆåŠŸäº†ã€‚å®ƒé¦–å…ˆæ‰“å°äº†æ­£å¸¸æ¨¡å‹çš„å‚æ•°ï¼Œç„¶åæ˜¯åŠ è½½æ¨¡å‹çš„å‚æ•°ã€‚æ‰€ä»¥è¿™äº›æ˜¯ç›¸åŒçš„ã€‚æ‰€ä»¥æˆ‘ä»¬çœ‹åˆ°æœ‰ä¸€ä¸ªåŒ…å«æƒé‡çš„å¼ é‡ï¼Œè¿˜æœ‰ä¸€ä¸ªåŒ…å«åç½®çš„å¼ é‡ï¼Œè¿™å¯¹æˆ‘ä»¬çš„ä¸¤ä¸ªæ¨¡å‹éƒ½æ˜¯ä¸€æ ·çš„ã€‚æ‰€ä»¥æˆ‘ä»¬çœ‹åˆ°è¿™ä¹ŸæˆåŠŸäº†ã€‚æ‰€ä»¥æ˜¯çš„ï¼Œå†æ¬¡ã€‚
- en: so this is the recommended way of doing it by saying safe dot model state diictã€‚
    And then when we load itï¼Œ we call a load state dict methodã€‚![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_35.png)
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™æ˜¯æ¨èçš„åšæ³•ï¼Œé€šè¿‡è°ƒç”¨`safe dot model state dict`ã€‚ç„¶åå½“æˆ‘ä»¬åŠ è½½å®ƒæ—¶ï¼Œæˆ‘ä»¬è°ƒç”¨ä¸€ä¸ª`load state dict`æ–¹æ³•ã€‚![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_35.png)
- en: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_36.png)'
  id: totrans-34
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_36.png)'
- en: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_37.png)'
  id: totrans-35
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_37.png)'
- en: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_38.png)'
  id: totrans-36
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_38.png)'
- en: And yeahï¼Œ so here we just save the state diã€‚ So this holds the parametersã€‚ So
    let me show you how this state dit looks likeã€‚ So when we have our modelã€‚ let's
    print model dot stateã€‚ğŸ˜Šã€‚![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_40.png)
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: æ˜¯çš„ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œæˆ‘ä»¬åªæ˜¯ä¿å­˜çŠ¶æ€å­—å…¸ã€‚æ‰€ä»¥è¿™ä¿å­˜äº†å‚æ•°ã€‚è®©æˆ‘å±•ç¤ºä¸€ä¸‹è¿™ä¸ªçŠ¶æ€å­—å…¸çš„æ ·å­ã€‚æ‰€ä»¥å½“æˆ‘ä»¬æœ‰æˆ‘ä»¬çš„æ¨¡å‹æ—¶ï¼Œè®©æˆ‘ä»¬æ‰“å°`model.state`ã€‚ğŸ˜Šï¼[](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_40.png)
- en: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_41.png)'
  id: totrans-38
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_41.png)'
- en: Dicktï¼Œ and let's save thisã€‚And let's clear this and run the scriptã€‚ Then we
    see here we have our state dickã€‚ So here we have the linear weightã€‚ which has
    the tenzo with the weightsã€‚ And then we also have theã€‚Bastenzorã€‚ So this is our
    state dicã€‚And now let me show you a common way of saving a whole checkpoint during
    training so as you knowã€‚
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶åï¼Œ*è®©æˆ‘ä»¬ä¿å­˜è¿™ä¸ª*ã€‚æ¥ä¸‹æ¥æ¸…é™¤è¿™ä¸ªå¹¶è¿è¡Œè„šæœ¬ã€‚ç„¶åæˆ‘ä»¬çœ‹åˆ°è¿™é‡Œæœ‰æˆ‘ä»¬çš„çŠ¶æ€å­—å…¸ã€‚å› æ­¤è¿™é‡Œæˆ‘ä»¬æœ‰çº¿æ€§æƒé‡ï¼ŒåŒ…å«æƒé‡çš„å¼ é‡ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªå¼ é‡ã€‚æ‰€ä»¥è¿™å°±æ˜¯æˆ‘ä»¬çš„çŠ¶æ€å­—å…¸ã€‚ç°åœ¨è®©æˆ‘ç»™ä½ å±•ç¤ºä¸€ä¸ªåœ¨è®­ç»ƒæœŸé—´ä¿å­˜æ•´ä¸ªæ£€æŸ¥ç‚¹çš„å¸¸è§æ–¹æ³•ï¼Œæ­£å¦‚ä½ æ‰€çŸ¥é“çš„ã€‚
- en: we can save any dictionary hereã€‚So let's say we also have a optimizer hereã€‚
    So let's say we defined a learning rateã€‚ So let's say this is 0001ã€‚ And we also
    have a optrã€‚ This isï¼Œ let's sayï¼Œ torch dot optimã€‚Dotã€‚Let's use stochastic gradient
    descentã€‚ And here we want to optimize the model parametersã€‚
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œä¿å­˜ä»»ä½•å­—å…¸ã€‚å‡è®¾æˆ‘ä»¬åœ¨è¿™é‡Œä¹Ÿæœ‰ä¸€ä¸ªä¼˜åŒ–å™¨ã€‚å‡è®¾æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå­¦ä¹ ç‡ã€‚è®¾ä¸º`0.0001`ã€‚æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªä¼˜åŒ–å™¨ã€‚å‡è®¾è¿™æ˜¯`torch.optim`ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨éšæœºæ¢¯åº¦ä¸‹é™ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬æƒ³ä¼˜åŒ–æ¨¡å‹å‚æ•°ã€‚
- en: and we will also have to give it the learning rate by saying learning rate equals
    the learning rate and our optimizer also has a state diã€‚ So we can also print
    the optimizer state diã€‚ Nowï¼Œ if we clear this and run thisã€‚ then we see the state
    dictionary of the optimizer where we can seeï¼Œ for exampleã€‚ the learning rate and
    the momentumã€‚So now during trainingã€‚
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬è¿˜éœ€è¦ç»™å®ƒå­¦ä¹ ç‡ï¼Œè®¾ç½®ä¸º`learning rate = learning rate`ï¼Œæˆ‘ä»¬çš„ä¼˜åŒ–å™¨ä¹Ÿæœ‰ä¸€ä¸ªçŠ¶æ€å­—å…¸ã€‚å› æ­¤æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰“å°ä¼˜åŒ–å™¨çš„çŠ¶æ€å­—å…¸ã€‚ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬æ¸…é™¤è¿™ä¸ªå¹¶è¿è¡Œè¿™ä¸ªã€‚é‚£ä¹ˆæˆ‘ä»¬çœ‹åˆ°ä¼˜åŒ–å™¨çš„çŠ¶æ€å­—å…¸ï¼Œå…¶ä¸­å¯ä»¥çœ‹åˆ°ï¼Œä¾‹å¦‚ï¼Œå­¦ä¹ ç‡å’ŒåŠ¨é‡ã€‚å› æ­¤ç°åœ¨åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ã€‚
- en: let's say we want to stop somewhere at some point during training and save a
    checkpointã€‚ Then we can do it like thisï¼Œ soã€‚![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_43.png)
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: å‡è®¾æˆ‘ä»¬æƒ³åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­æŸä¸ªæ—¶åˆ»æš‚åœå¹¶ä¿å­˜ä¸€ä¸ªæ£€æŸ¥ç‚¹ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼Œæ‰€ä»¥ä¸‹é¢æ˜¯ï¼[](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_43.png)
- en: We create our checkpointï¼Œ and this must be a dictionaryã€‚ So let's create a dictionaryã€‚
    And as a first thingï¼Œ what we want to save isï¼Œ for exampleï¼Œ the epochã€‚ So let's
    define the epochã€‚ So the key is called epochã€‚ And let's say we are justï¼Œ we are
    an epoch 90ã€‚ And then we want to save the model stateã€‚ So we have to give it a
    keyã€‚ let's say model stateã€‚
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬åˆ›å»ºæˆ‘ä»¬çš„æ£€æŸ¥ç‚¹ï¼Œè¿™å¿…é¡»æ˜¯ä¸€ä¸ªå­—å…¸ã€‚æ‰€ä»¥æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªå­—å…¸ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬æƒ³ä¿å­˜çš„å†…å®¹æ˜¯ï¼Œæ¯”å¦‚è¯´ï¼Œçºªå…ƒã€‚æ‰€ä»¥æˆ‘ä»¬æ¥å®šä¹‰è¿™ä¸ªçºªå…ƒã€‚é”®å«åšepochã€‚å‡è®¾æˆ‘ä»¬æ­£å¤„äºç¬¬90ä¸ªçºªå…ƒã€‚ç„¶åæˆ‘ä»¬æƒ³ä¿å­˜æ¨¡å‹çŠ¶æ€ã€‚æ‰€ä»¥æˆ‘ä»¬å¿…é¡»ç»™å®ƒä¸€ä¸ªé”®ã€‚å‡è®¾æ˜¯model
    stateã€‚
- en: And here we use model dot state diictã€‚And then we also want to save the optimizer
    state dickã€‚ So the keyï¼Œ let's sayï¼Œ optim stateã€‚ And then here as a valueï¼Œ we have
    to call optr state dickã€‚ So this is our checkpointã€‚ And now we can call torch
    dot saveã€‚
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨æ¨¡å‹çš„çŠ¶æ€å­—å…¸ã€‚ç„¶åæˆ‘ä»¬è¿˜æƒ³ä¿å­˜ä¼˜åŒ–å™¨çŠ¶æ€å­—å…¸ã€‚é”®ï¼Œå‡è®¾ä¸ºoptim stateã€‚ç„¶åè¿™é‡Œçš„å€¼ï¼Œæˆ‘ä»¬å¿…é¡»è°ƒç”¨optr stateå­—å…¸ã€‚æ‰€ä»¥è¿™æ˜¯æˆ‘ä»¬çš„æ£€æŸ¥ç‚¹ã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥è°ƒç”¨torch
    dot saveã€‚
- en: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_45.png)'
  id: totrans-45
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_45.png)'
- en: And then save the whole checkpointã€‚ So let's say torch checkpoint asï¼Œ as a file
    nameã€‚ Let's call this checkã€‚Point dot Pï¼Œ T Hã€‚![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_47.png)
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶åä¿å­˜æ•´ä¸ªæ£€æŸ¥ç‚¹ã€‚æ‰€ä»¥å‡è®¾torch checkpointä½œä¸ºæ–‡ä»¶åã€‚æˆ‘ä»¬ç§°è¿™ä¸ªä¸ºcheck.Point dot Pï¼Œ T Hã€‚![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_47.png)
- en: And now againï¼Œ let me show you the explorer and let's run the scriptã€‚![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_49.png)
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨å†æ¬¡ï¼Œè®©æˆ‘ç»™ä½ çœ‹çœ‹èµ„æºç®¡ç†å™¨ï¼Œè¿è¡Œè„šæœ¬ã€‚![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_49.png)
- en: So now we clear this and run thisã€‚ Then we see we have our checkpoint hereã€‚
    And nowã€‚ when we load thisï¼Œ we want to load the whole checkpointï¼Œ soã€‚![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_51.png)
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨æˆ‘ä»¬æ¸…é™¤è¿™ä¸ªå¹¶è¿è¡Œå®ƒã€‚ç„¶åæˆ‘ä»¬çœ‹åˆ°è¿™é‡Œæœ‰æˆ‘ä»¬çš„æ£€æŸ¥ç‚¹ã€‚ç°åœ¨ï¼Œå½“æˆ‘ä»¬åŠ è½½è¿™ä¸ªæ—¶ï¼Œæˆ‘ä»¬æƒ³åŠ è½½æ•´ä¸ªæ£€æŸ¥ç‚¹ï¼Œæ‰€ä»¥ã€‚![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_51.png)
- en: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_52.png)'
  id: totrans-49
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_52.png)'
- en: We can comment this outã€‚ And alsoï¼Œ we don't need thisï¼Œ soã€‚![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_54.png)
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å¯ä»¥æ³¨é‡Šæ‰è¿™ä¸ªã€‚åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿä¸éœ€è¦è¿™ä¸ªï¼Œæ‰€ä»¥ã€‚![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_54.png)
- en: Let's say our loaded checkpointã€‚ So let's sayï¼Œ loaded checkpointã€‚Equals torch
    dot loadã€‚ And then the file name was the same as this oneã€‚![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_56.png)
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: å‡è®¾æˆ‘ä»¬çš„åŠ è½½æ£€æŸ¥ç‚¹ã€‚å‡è®¾ï¼Œloaded checkpointç­‰äºtorch dot loadã€‚ç„¶åæ–‡ä»¶åä¸è¿™ä¸ªç›¸åŒã€‚![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_56.png)
- en: And now you have to set up the differentã€‚Model and optimizes againã€‚ so we can
    get the epoch right away by saying epoch equals load at checkpointã€‚ So this is
    a dictionaryã€‚ so we can justã€‚![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_58.png)
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨ä½ å¿…é¡»é‡æ–°è®¾ç½®ä¸åŒçš„æ¨¡å‹å’Œä¼˜åŒ–å™¨ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥ç«‹å³è·å¾—çºªå…ƒï¼Œæ–¹æ³•æ˜¯è¯´epochç­‰äºload at checkpointã€‚è¿™æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥ã€‚![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_58.png)
- en: Call theã€‚Or access the epoch keyã€‚ And then for the modelã€‚ rememberã€‚ we have
    to create our model here againã€‚ So let's say model equalsã€‚ and then the model
    with the number of input features equals 6 and the optimizer equals the same as
    this oneã€‚ So we don't have to use the same learning rate actuallyã€‚
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: è°ƒç”¨ã€‚æˆ–è€…è®¿é—®çºªå…ƒé”®ã€‚ç„¶åå¯¹äºæ¨¡å‹ã€‚è®°ä½ã€‚æˆ‘ä»¬å¿…é¡»åœ¨è¿™é‡Œå†æ¬¡åˆ›å»ºæˆ‘ä»¬çš„æ¨¡å‹ã€‚æ‰€ä»¥å‡è®¾æ¨¡å‹ç­‰äºã€‚ç„¶åæ¨¡å‹çš„è¾“å…¥ç‰¹å¾æ•°é‡ç­‰äº6ï¼Œä¼˜åŒ–å™¨ä¸è¿™ä¸ªç›¸åŒã€‚å®é™…ä¸Šæˆ‘ä»¬ä¸å¿…ä½¿ç”¨ç›¸åŒçš„å­¦ä¹ ç‡ã€‚
- en: So let me just grab this one here and paste it down hereã€‚ And for exampleã€‚ we
    can use the learning rate 0ã€‚ And then laterï¼Œ we can see that we load the correct
    learning rate into the optimizerã€‚ Soã€‚![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_60.png)
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: è®©æˆ‘æŠŠè¿™ä¸ªå¤åˆ¶è¿‡æ¥ï¼Œç²˜è´´åœ¨è¿™é‡Œã€‚ä¾‹å¦‚ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å­¦ä¹ ç‡0ã€‚ç„¶åç¨åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å°†æ­£ç¡®çš„å­¦ä¹ ç‡åŠ è½½åˆ°ä¼˜åŒ–å™¨ä¸­ã€‚æ‰€ä»¥ã€‚![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_60.png)
- en: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_61.png)'
  id: totrans-55
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_61.png)'
- en: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_62.png)'
  id: totrans-56
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_62.png)'
- en: Nowï¼Œ let's say model dot load stateã€‚Dicksï¼Œ and then here we give it the checkpointã€‚
    and then we access the keyã€‚ We call it model stateã€‚ So this will load all the
    parameters into our modelã€‚ and the same with our optimizerã€‚ So we call optimizer
    dot load state disã€‚ and then we use the checkpointã€‚
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨ï¼Œå‡è®¾æ¨¡å‹åŠ è½½çŠ¶æ€ã€‚ç„¶åè¿™é‡Œæˆ‘ä»¬ç»™å®ƒæ£€æŸ¥ç‚¹ã€‚ç„¶åæˆ‘ä»¬è®¿é—®é”®ã€‚æˆ‘ä»¬ç§°ä¹‹ä¸ºmodel stateã€‚æ‰€ä»¥è¿™å°†åŠ è½½æ‰€æœ‰å‚æ•°åˆ°æˆ‘ä»¬çš„æ¨¡å‹ä¸­ã€‚ä¼˜åŒ–å™¨ä¹Ÿæ˜¯å¦‚æ­¤ã€‚æˆ‘ä»¬ç§°ä¼˜åŒ–å™¨ä¸ºload
    state disã€‚ç„¶åä½¿ç”¨æ£€æŸ¥ç‚¹ã€‚
- en: And here we call it optim stateã€‚ So now we have the loaded model and the optr
    and also the current epochã€‚ So we can continue our trainingã€‚![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_64.png)
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è¿™é‡Œæˆ‘ä»¬ç§°å®ƒä¸ºoptim stateã€‚æ‰€ä»¥ç°åœ¨æˆ‘ä»¬æœ‰äº†åŠ è½½çš„æ¨¡å‹å’Œä¼˜åŒ–å™¨ï¼Œä»¥åŠå½“å‰çš„çºªå…ƒã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç»§ç»­è®­ç»ƒã€‚![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_64.png)
- en: And let me show you that this is all correct by saying we want to print the
    optimizer dot state diã€‚ So if you notice hereï¼Œ we set the learning rate to 0 and
    then we loaded the correct state diã€‚ So now if we run thisã€‚ And as a last thingï¼Œ
    we printed the optimizer state diã€‚ then we see we have the same learning rate
    as in the initial optimizerã€‚ So this work2ã€‚
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: è®©æˆ‘é€šè¿‡æ‰“å°ä¼˜åŒ–å™¨çš„ `state_dict` æ¥éªŒè¯è¿™ä¸€åˆ‡æ˜¯å¦æ­£ç¡®ã€‚æ‰€ä»¥å¦‚æœä½ æ³¨æ„åˆ°ï¼Œæˆ‘ä»¬å°†å­¦ä¹ ç‡è®¾ç½®ä¸º 0ï¼Œç„¶ååŠ è½½äº†æ­£ç¡®çš„ `state_dict`ã€‚ç°åœ¨å¦‚æœæˆ‘ä»¬è¿è¡Œè¿™ä¸ªã€‚æœ€åï¼Œæˆ‘ä»¬æ‰“å°äº†ä¼˜åŒ–å™¨çš„
    `state_dict`ï¼Œç„¶åçœ‹åˆ°æˆ‘ä»¬æœ‰ä¸åˆå§‹ä¼˜åŒ–å™¨ç›¸åŒçš„å­¦ä¹ ç‡ã€‚å› æ­¤è¿™æœ‰æ•ˆã€‚
- en: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_66.png)'
  id: totrans-60
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_66.png)'
- en: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_67.png)'
  id: totrans-61
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_67.png)'
- en: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_68.png)'
  id: totrans-62
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_68.png)'
- en: So this is how we can save and load a whole checkpointã€‚ And yeahã€‚ these are
    all the three ways of saving you have to knowã€‚ And now as a last thingã€‚ I want
    to show you what you have to consider when you are using a GPU during trainingã€‚
    So if you are doing training and loading both on the CPU then you don't have to
    make any differenceã€‚
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™å°±æ˜¯æˆ‘ä»¬å¦‚ä½•ä¿å­˜å’ŒåŠ è½½æ•´ä¸ªæ£€æŸ¥ç‚¹ã€‚æ˜¯çš„ï¼Œè¿™ä¸‰ç§ä¿å­˜æ–¹æ³•ä½ å¿…é¡»çŸ¥é“ã€‚æœ€åï¼Œæˆ‘æƒ³å‘Šè¯‰ä½ åœ¨ä½¿ç”¨ GPU è¿›è¡Œè®­ç»ƒæ—¶éœ€è¦è€ƒè™‘çš„äº‹é¡¹ã€‚å¦‚æœä½ åœ¨ CPU ä¸Šè¿›è¡Œè®­ç»ƒå’ŒåŠ è½½ï¼Œé‚£ä¹ˆä½ ä¸éœ€è¦åšä»»ä½•åŒºåˆ«ã€‚
- en: So you can just use it like I did hereï¼Œ But now if you save your model on the
    GPã€‚ And then later you want to load it on the CPUï¼Œ then you have to do it this
    wayã€‚ So let's say somewhere during your trainingï¼Œ you set up your ka device and
    you send your model to the device and then you save it by using the state dã€‚
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: æ‰€ä»¥ä½ å¯ä»¥åƒæˆ‘åœ¨è¿™é‡Œåšçš„é‚£æ ·ä½¿ç”¨å®ƒï¼Œä½†å¦‚æœä½ åœ¨ GPU ä¸Šä¿å­˜æ¨¡å‹ï¼Œç„¶åç¨åæƒ³åœ¨ CPU ä¸ŠåŠ è½½ï¼Œé‚£ä¹ˆä½ å¿…é¡»è¿™æ ·åšã€‚å‡è®¾åœ¨ä½ è®­ç»ƒçš„æŸä¸ªæ—¶åˆ»ï¼Œä½ è®¾ç½®äº† CUDA
    è®¾å¤‡å¹¶å°†æ¨¡å‹å‘é€åˆ°è®¾å¤‡ï¼Œç„¶åé€šè¿‡ä½¿ç”¨ `state_dict` ä¿å­˜å®ƒã€‚
- en: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_70.png)'
  id: totrans-65
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_70.png)'
- en: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_71.png)'
  id: totrans-66
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_71.png)'
- en: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_72.png)'
  id: totrans-67
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_72.png)'
- en: And then you want to load it to the CPUã€‚ So you have your CPU deviceã€‚ then you
    create your model againï¼Œ and then you call load state died and then load pathã€‚
    And here you have to specify the map locationã€‚ And here you give it the CPU deviceã€‚
    So this is if you want to save on the GP and load on the CPUã€‚
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶åä½ æƒ³è¦åŠ è½½åˆ° CPUã€‚æ‰€ä»¥ä½ æœ‰ä½ çš„ CPU è®¾å¤‡ï¼Œç„¶åé‡æ–°åˆ›å»ºæ¨¡å‹ï¼Œå†è°ƒç”¨ `load_state_dict` å’ŒåŠ è½½è·¯å¾„ã€‚åœ¨è¿™é‡Œä½ å¿…é¡»æŒ‡å®šæ˜ å°„ä½ç½®ï¼Œå¹¶ç»™å®ƒ
    CPU è®¾å¤‡ã€‚å¦‚æœä½ æƒ³åœ¨ GPU ä¸Šä¿å­˜å¹¶åœ¨ CPU ä¸ŠåŠ è½½ï¼Œå°±è¿™æ ·åšã€‚
- en: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_74.png)'
  id: totrans-69
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_74.png)'
- en: Nowï¼Œ if you want to do both on the GPUã€‚ So you send your model to the Kuda device
    and saved itã€‚ and then you also want to load it on the GPUï¼Œ then you just do it
    like thisã€‚ So youã€‚Set up your modelï¼Œ you load the state diï¼Œ and then you send
    your model to the Kuda deviceã€‚
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨ï¼Œå¦‚æœä½ æƒ³åœ¨ GPU ä¸ŠåŒæ—¶è¿›è¡Œè¿™ä¸¤é¡¹æ“ä½œã€‚ä½ å°†æ¨¡å‹å‘é€åˆ° CUDA è®¾å¤‡å¹¶ä¿å­˜ï¼Œç„¶åä½ ä¹Ÿæƒ³åœ¨ GPU ä¸ŠåŠ è½½å®ƒï¼Œä½ åªéœ€è¿™æ ·åšã€‚è®¾ç½®ä½ çš„æ¨¡å‹ï¼ŒåŠ è½½
    `state_dict`ï¼Œç„¶åå°†æ¨¡å‹å‘é€åˆ° CUDA è®¾å¤‡ã€‚
- en: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_76.png)'
  id: totrans-71
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_76.png)'
- en: And now as a third optionã€‚ So let's say you saved your model on the CPUã€‚ So
    you didn't sendã€‚ you didn't call model to Kuda device somewhereã€‚ But then laterï¼Œ
    during loadingã€‚ you want to load it to the GPï¼Œ you have to do it like thisã€‚ So
    first you specify your Ka deviceã€‚ Then you create your modelã€‚
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨ä½œä¸ºç¬¬ä¸‰ä¸ªé€‰é¡¹ã€‚å‡è®¾ä½ åœ¨ CPU ä¸Šä¿å­˜äº†æ¨¡å‹ï¼Œæ‰€ä»¥ä½ æ²¡æœ‰å°†æ¨¡å‹å‘é€åˆ° CUDA è®¾å¤‡ä¸Šã€‚ä½†åæ¥åœ¨åŠ è½½æ—¶ï¼Œä½ æƒ³å°†å…¶åŠ è½½åˆ° GPU ä¸Šï¼Œä½ å¿…é¡»è¿™æ ·åšã€‚é¦–å…ˆï¼Œä½ æŒ‡å®šä½ çš„
    CUDA è®¾å¤‡ï¼Œç„¶ååˆ›å»ºä½ çš„æ¨¡å‹ã€‚
- en: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_78.png)'
  id: totrans-73
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_78.png)'
- en: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_79.png)'
  id: totrans-74
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_79.png)'
- en: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_80.png)'
  id: totrans-75
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_80.png)'
- en: And then you call model dot load date diiced and then torch load with the path
    and then as map locationã€‚ you specify Kuda and then colon and then any GPU device
    number you wantã€‚ So for exampleã€‚ Kuda colon0ã€‚ and then also you have to call model
    to device So to the ka deviceã€‚ So this will send the model to device to the device
    and also all the loaded parameter tenzoos to the device So then you can continue
    with your training or interference on the GPUã€‚
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶åä½ è°ƒç”¨æ¨¡å‹çš„ `load_state_dict`ï¼Œæ¥ç€ç”¨è·¯å¾„è°ƒç”¨ `torch.load`ï¼Œå¹¶æŒ‡å®šæ˜ å°„ä½ç½®ã€‚ä½ éœ€è¦æŒ‡å®š CUDAï¼Œç„¶åæ˜¯å†’å·ï¼Œå†åŠ ä¸Šä½ æƒ³è¦çš„ä»»ä½•
    GPU è®¾å¤‡ç¼–å·ã€‚ä¾‹å¦‚ï¼ŒCUDA:0ã€‚ç„¶åä½ è¿˜éœ€è¦è°ƒç”¨æ¨¡å‹åˆ°è®¾å¤‡ï¼Œæ‰€ä»¥æŒ‡å®šåˆ° CUDA è®¾å¤‡ã€‚è¿™ä¼šå°†æ¨¡å‹å’Œæ‰€æœ‰åŠ è½½çš„å‚æ•°å¼ é‡å‘é€åˆ°è®¾å¤‡ä¸Šã€‚è¿™æ ·ä½ å°±å¯ä»¥ç»§ç»­åœ¨
    GPU ä¸Šè¿›è¡Œè®­ç»ƒæˆ–æ¨ç†ã€‚
- en: and of courseï¼Œ you also have to send all the training samples to the device
    that you then use for the forward pathã€‚![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_82.png)
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: å½“ç„¶ï¼Œä½ è¿˜å¿…é¡»å°†æ‰€æœ‰è®­ç»ƒæ ·æœ¬å‘é€åˆ°ç”¨äºå‰å‘ä¼ æ’­çš„è®¾å¤‡ä¸Šã€‚![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_82.png)
- en: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_83.png)'
  id: totrans-78
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_83.png)'
- en: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_84.png)'
  id: totrans-79
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_84.png)'
- en: So yeahï¼Œ this is what you have to consider when you're using a GPUã€‚![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_86.png)
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: æ‰€ä»¥ï¼Œæ˜¯çš„ï¼Œå½“ä½ ä½¿ç”¨GPUæ—¶ï¼Œè¿™äº›æ˜¯ä½ éœ€è¦è€ƒè™‘çš„äº‹é¡¹ã€‚![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_86.png)
- en: And nowï¼Œ you know all the different ways of saving and loading your modelã€‚ And
    yeahã€‚ that's all for nowã€‚ I hope you enjoyed this tutorialã€‚ And if you like this
    then please consider subscribing to the channel and see you next timeï¼Œ byeã€‚ğŸ˜Šã€‚![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_88.png)
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨ï¼Œä½ äº†è§£äº†ä¿å­˜å’ŒåŠ è½½æ¨¡å‹çš„å„ç§æ–¹æ³•ã€‚ æ˜¯çš„ï¼Œè¿™å°±æ˜¯ç›®å‰ä¸ºæ­¢çš„æ‰€æœ‰å†…å®¹ã€‚ å¸Œæœ›ä½ å–œæ¬¢è¿™ä¸ªæ•™ç¨‹ã€‚å¦‚æœä½ å–œæ¬¢ï¼Œè¯·è€ƒè™‘è®¢é˜…é¢‘é“ï¼Œä¸‹æ¬¡è§ï¼Œå†è§ã€‚ğŸ˜Šã€‚![](img/d077e5bf8acaccfa2f2d408a7bb4ae8d_88.png)
