# 【双语字幕+资料下载】Pytorch 进阶学习讲座！14位 Facebook 工程师带你解锁 PyTorch 的生产应用与技术细节 ＜官方教程系列＞ - P14：L14- PyTorch 移动和 Android 神经网络 API - ShowMeAI - BV1ZZ4y1U7dg

🎼。![](img/2143cfd2c52c8c795e5af20d99916e1d_1.png)

嗨，我是 Ollly，Android 机器学习的产品经理。今天我将与您谈谈 Pytorch 对 Android 神经网络 API 的支持。在设备上进行机器学习可以带来一系列好处。通过将计算移到数据本地，我们可以提高隐私保护。

确保我们的功能在间歇性连接情况下也能正常工作，并减少延迟。这带来了诸多好处。😊。![](img/2143cfd2c52c8c795e5af20d99916e1d_3.png)

但在移动设备上，我们始终面临功率限制。因此，尽可能高效地进行计算至关重要。![](img/2143cfd2c52c8c795e5af20d99916e1d_5.png)

幸运的是，现代设备拥有一系列专业芯片，能够真正提供帮助。😊 GPU、DSP 和新型专用的机器学习硬件加速器，通常称为 NPU，可以在不单独使用 CPU 的情况下提高功率效率。这些芯片各自适合不同的任务，不同的移动设备可以配置不同的芯片组合。这种复杂性可能使得在所有用户中推广一个功能变得困难。

因此，Android 神经网络 API 提供了一个一致的计算卸载接口。右侧的图示展示了一个示例架构。应用可以调用机器学习框架或直接调用神经网络 API。然后图形根据设备在运行时的能力进行分区。

这些分区随后被传递给特定的供应商驱动程序代码，以根据所使用的硬件优化调用。我们一直在构建这些功能，在 Android 11 中支持超过 100 个操作，包括 LSTM。我们有浮点和量化数据类型，现在可以在图中直接使用 if 和 while 构造实现控制流。诸如服务质量、异步命令缓冲和内存域等功能使工作负载的优化变得更加广泛。

我们还将 Android 神经网络 API 制作成了可升级模块。这意味着我们可以在 Android 版本发布之外进行更新，以更好地跟上机器学习社区的步伐。机器学习的进步以及更强的加速可以在开发功能时带来显著的好处。MLKt 在从 CPU 切换到使用 API 后，看到延迟减少了 9 倍。

Google Lens 团队在将其 OCR 模型切换到 API 后，看到近 4 倍的性能提升。我们希望将这些好处带给尽可能多的开发者，因此很高兴 Pytorch Mobile 已经增加了对神经网络 API 的支持。![](img/2143cfd2c52c8c795e5af20d99916e1d_7.png)

利用Pytorch Mo，你可以获得相同熟悉的Pytorch API，而无需编写本地C代码。你可以直接从CPU卸载到专用硬件，以在Android生态系统中获得最佳性能。那么，如何开始呢？其实非常简单。![](img/2143cfd2c52c8c795e5af20d99916e1d_9.png)

首先，下载Pythtorch mobile夜间版本，然后转换你的模型。![](img/2143cfd2c52c8c795e5af20d99916e1d_11.png)

这只是一小段代码，如此展示。你需要使用你的torchscript模型。创建一个输入变量以匹配输入形状，然后将布局设置为N HWC。接着你可以转换你的模型。可选地，如果你愿意，可以将输入打包，以便于基准测试。最后。

保存你的模型，你就可以开始使用了。![](img/2143cfd2c52c8c795e5af20d99916e1d_13.png)

当进行运行时推理时，如果你使用基准测试或直接在你的应用中，则不需要任何代码更改。只需将现有模型切换为新的N& API模型。实时分割是一个可以真正受益于硬件加速的功能。想象一下，在虚拟绿幕效果中，试图从背景中识别前景用户的场景。

你希望持续运行此功能并保持低延迟，以提供响应迅速的用户体验。但通常你还会同时进行大量并行计算，例如视频合成效果。Facebook Messenger团队现在正在测试N API，以用于他们的沉浸式360背景功能，利用新的Pytorrch mobile能力。他们看到延迟减少了两倍，功耗也减少了两倍。

初始版本支持一套强大但小型的功能。它支持Android 10+设备，线性卷积模型，如Facebook Ne和多层感知器模型。此外，团队正在全力以赴开发下一组功能，包括更多的操作符类型，支持流行的mask RCNN模型以及优化CPU路径的回退。

团队还在调查对早期设备和控制流语义的额外支持。这是对Android神经网络API的新Pytorj mobile支持的简要概述。今天下载Pytorch mobile夜间版本，开始测试代码。请务必提供你的反馈。

![](img/2143cfd2c52c8c795e5af20d99916e1d_15.png)

想要了解更多关于Android Ne网络API的信息，请查看Android NDKDevelop文档；想了解更多关于Pytorch mobile集成的信息，请访问Pytorch mobileDevelop页面。![](img/2143cfd2c52c8c795e5af20d99916e1d_17.png)

🎼我们迫不及待想看到你如何利用Pytorch mobile的全部硬件能力，在Android上创造出令人惊叹的机器学习驱动体验。谢谢你。😊。![](img/2143cfd2c52c8c795e5af20d99916e1d_19.png)
