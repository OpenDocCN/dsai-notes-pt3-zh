- en: ã€åŒè¯­å­—å¹•+èµ„æ–™ä¸‹è½½ã€‘Pytorch è¿›é˜¶å­¦ä¹ è®²åº§ï¼14ä½Facebookå·¥ç¨‹å¸ˆå¸¦ä½ è§£é” PyTorch çš„ç”Ÿäº§åº”ç”¨ä¸æŠ€æœ¯ç»†èŠ‚ ï¼œå®˜æ–¹æ•™ç¨‹ç³»åˆ—ï¼ - P9ï¼šL9-
    æœ€æ–°çš„ Profiler API å’Œæœ€ä½³å®è·µ - ShowMeAI - BV1ZZ4y1U7dg
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ã€åŒè¯­å­—å¹•+èµ„æ–™ä¸‹è½½ã€‘Pytorchè¿›é˜¶å­¦ä¹ è®²åº§ï¼14ä½Facebookå·¥ç¨‹å¸ˆå¸¦ä½ è§£é”PyTorchçš„ç”Ÿäº§åº”ç”¨ä¸æŠ€æœ¯ç»†èŠ‚ ï¼œå®˜æ–¹æ•™ç¨‹ç³»åˆ—ï¼ - P9ï¼šL9-
    æœ€æ–°çš„Profiler APIå’Œæœ€ä½³å®è·µ - ShowMeAI - BV1ZZ4y1U7dg
- en: ğŸ¼ã€‚![](img/8ecf516795c50978f573dce9c644f972_1.png)
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: ğŸ¼ã€‚![](img/8ecf516795c50978f573dce9c644f972_1.png)
- en: Helloï¼Œ my name is Elliaï¼Œ I'm a software engineer at Facebook working on PyOch
    and in this presentation I'll talk about PyTch Pror and two new features that
    we recently addedã€‚![](img/8ecf516795c50978f573dce9c644f972_3.png)
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: ä½ å¥½ï¼Œæˆ‘å«Elliaï¼Œæˆ‘æ˜¯ä¸€ååœ¨Facebookå·¥ä½œçš„è½¯ä»¶å·¥ç¨‹å¸ˆï¼Œä¸“æ³¨äºPyOchã€‚åœ¨è¿™æ¬¡æ¼”è®²ä¸­ï¼Œæˆ‘å°†è®¨è®ºPyTch Prorå’Œæˆ‘ä»¬æœ€è¿‘æ·»åŠ çš„ä¸¤ä¸ªæ–°åŠŸèƒ½ã€‚![](img/8ecf516795c50978f573dce9c644f972_3.png)
- en: So what is Pytoch Pror Pytoch includes an easy to use tool that allows you to
    measure runtime and other performance metrics of models operatorsã€‚In a simple
    exampleï¼Œ we first start with necessary module inputsã€‚ then we create Gsite 18
    model and then as you can see we're on model inference insideã€‚By profile Cons
    managerã€‚Everything inside this Conx Manager is profiledï¼Œ and once you have finishedã€‚
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: é‚£ä¹ˆPytoch Proræ˜¯ä»€ä¹ˆï¼ŸPytochåŒ…å«ä¸€ä¸ªæ˜“äºä½¿ç”¨çš„å·¥å…·ï¼Œå…è®¸ä½ æµ‹é‡æ¨¡å‹æ“ä½œç¬¦çš„è¿è¡Œæ—¶å’Œå…¶ä»–æ€§èƒ½æŒ‡æ ‡ã€‚åœ¨ä¸€ä¸ªç®€å•çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¼€å§‹å¿…è¦çš„æ¨¡å—è¾“å…¥ï¼Œç„¶ååˆ›å»ºGsite
    18æ¨¡å‹ï¼Œæ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œæˆ‘ä»¬åœ¨æ¨¡å‹æ¨ç†ä¸­ã€‚é€šè¿‡Profile Consç®¡ç†å™¨ã€‚ä¸€åˆ‡éƒ½åœ¨è¿™ä¸ªConxç®¡ç†å™¨å†…éƒ¨è¢«åˆ†æï¼Œä¸€æ—¦ä½ å®Œæˆã€‚
- en: you can print out the resultsã€‚In this caseï¼Œ you will see a table with entries
    grouped by operator nameã€‚And with some rail metrics such as self and total CPU
    timeã€‚Profiller also has more features such as group by operator input shapesã€‚
    support for both CPU and GPU operatorsï¼Œ custom labeled code rangersã€‚
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: ä½ å¯ä»¥æ‰“å°å‡ºç»“æœã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ ä¼šçœ‹åˆ°ä¸€ä¸ªæŒ‰æ“ä½œç¬¦åç§°åˆ†ç»„çš„è¡¨æ ¼ï¼Œå¹¶ä¸”æœ‰ä¸€äº›å…³äºè‡ªæˆ‘å’Œæ€»CPUæ—¶é—´çš„æŒ‡æ ‡ã€‚Profilerè¿˜å…·æœ‰æ›´å¤šåŠŸèƒ½ï¼Œä¾‹å¦‚æŒ‰æ“ä½œç¬¦è¾“å…¥å½¢çŠ¶åˆ†ç»„ï¼Œæ”¯æŒCPUå’ŒGPUæ“ä½œç¬¦ï¼Œè‡ªå®šä¹‰æ ‡ç­¾ä»£ç èŒƒå›´ã€‚
- en: and saving the trace in Chrome JON formatã€‚For exampleã€‚ if you want to see the
    input shapes of the operatorsã€‚Just past record shapes true and grew by input shapesã€‚In
    this caseã€‚ we see multiple operators such as convolution with different input
    shapes as expectedã€‚
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: å¹¶ä»¥Chrome JONæ ¼å¼ä¿å­˜è·Ÿè¸ªã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³æŸ¥çœ‹æ“ä½œç¬¦çš„è¾“å…¥å½¢çŠ¶ï¼Œåªéœ€ä¼ é€’è®°å½•å½¢çŠ¶ä¸ºçœŸï¼Œå¹¶æŒ‰è¾“å…¥å½¢çŠ¶åˆ†ç»„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çœ‹åˆ°å¤šä¸ªæ“ä½œç¬¦ï¼Œä¾‹å¦‚å·ç§¯ï¼Œå…·æœ‰ä¸åŒçš„è¾“å…¥å½¢çŠ¶ã€‚
- en: So let's check the check in memory usage feature that we recently addedã€‚In addition
    to measuring runtimeï¼Œ Pror can also be used to measure the amount of tensor memory
    used by the model's operatorsã€‚Just pass Pro memory trueï¼Œ and then you can sort
    by CPU or Quda memory usageã€‚In our exampleã€‚ we see that most of the memory was
    consumed by empty operatorã€‚
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: æ‰€ä»¥è®©æˆ‘ä»¬æ£€æŸ¥æœ€è¿‘æ·»åŠ çš„å†…å­˜ä½¿ç”¨æƒ…å†µåŠŸèƒ½ã€‚é™¤äº†æµ‹é‡è¿è¡Œæ—¶ï¼ŒProrè¿˜å¯ä»¥ç”¨æ¥æµ‹é‡æ¨¡å‹æ“ä½œç¬¦ä½¿ç”¨çš„å¼ é‡å†…å­˜é‡ã€‚åªéœ€ä¼ é€’Proå†…å­˜ä¸ºçœŸï¼Œç„¶åä½ å¯ä»¥æŒ‰CPUæˆ–Qudaå†…å­˜ä½¿ç”¨é‡è¿›è¡Œæ’åºã€‚åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°å¤§éƒ¨åˆ†å†…å­˜è¢«ç©ºæ“ä½œç¬¦æ¶ˆè€—ã€‚
- en: which is not surprising because we use this operator to create new tensorsã€‚And
    also memory was consumed by Resize operatorï¼Œ which is used to change tensor sizeã€‚Based
    on the total CPU memory columnï¼Œ you can see that there are other operators that
    directly or indirectly call empty and resizeã€‚
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™å¹¶ä¸ä»¤äººæƒŠè®¶ï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªæ“ä½œç¬¦æ¥åˆ›å»ºæ–°çš„å¼ é‡ã€‚æ­¤å¤–ï¼ŒResizeæ“ä½œç¬¦ä¹Ÿæ¶ˆè€—äº†å†…å­˜ï¼Œå®ƒç”¨äºæ”¹å˜å¼ é‡çš„å¤§å°ã€‚æ ¹æ®æ€»CPUå†…å­˜åˆ—ï¼Œä½ å¯ä»¥çœ‹åˆ°è¿˜æœ‰å…¶ä»–æ“ä½œç¬¦ç›´æ¥æˆ–é—´æ¥è°ƒç”¨ç©ºå’Œresizeã€‚
- en: '![](img/8ecf516795c50978f573dce9c644f972_5.png)'
  id: totrans-8
  prefs: []
  type: TYPE_IMG
  zh: '![](img/8ecf516795c50978f573dce9c644f972_5.png)'
- en: But what if you want to know not only the operatorï¼Œ but where in the model the
    operator isï¼Ÿ
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: ä½†æ˜¯å¦‚æœä½ æƒ³çŸ¥é“çš„ä¸ä»…æ˜¯æ“ä½œç¬¦ï¼Œè¿˜æœ‰æ“ä½œç¬¦åœ¨æ¨¡å‹ä¸­çš„ä½ç½®å‘¢ï¼Ÿ
- en: '![](img/8ecf516795c50978f573dce9c644f972_7.png)'
  id: totrans-10
  prefs: []
  type: TYPE_IMG
  zh: '![](img/8ecf516795c50978f573dce9c644f972_7.png)'
- en: Stack traces are helpful in cases like thisã€‚So you can justã€‚Pass with stack2ã€‚
    and then you can group by top and stack entriesã€‚And in our exampleã€‚ we see that
    there are two top Mkelian N convolution operatorsã€‚And in the source locationã€‚
    we can see not only the location inside torch andM convolution modelã€‚
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: å †æ ˆè·Ÿè¸ªåœ¨è¿™ç§æƒ…å†µä¸‹å¾ˆæœ‰å¸®åŠ©ã€‚å› æ­¤ä½ å¯ä»¥åªéœ€ä¼ é€’stack2ï¼Œç„¶åæŒ‰é¡¶éƒ¨å’Œå †æ ˆæ¡ç›®è¿›è¡Œåˆ†ç»„ã€‚åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°æœ‰ä¸¤ä¸ªé¡¶éƒ¨Mkelian Nå·ç§¯æ“ä½œç¬¦ã€‚åœ¨æºä½ç½®ï¼Œæˆ‘ä»¬ä¸ä»…å¯ä»¥çœ‹åˆ°torchå’ŒMå·ç§¯æ¨¡å‹å†…éƒ¨çš„ä½ç½®ã€‚
- en: but also two different coal sites in the original Resnet model scriptã€‚![](img/8ecf516795c50978f573dce9c644f972_9.png)
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: ä½†ä¹Ÿæœ‰ä¸¤ä¸ªä¸åŒçš„ç…¤ç‚­ç«™ç‚¹åœ¨åŸå§‹Resnetæ¨¡å‹è„šæœ¬ä¸­ã€‚![](img/8ecf516795c50978f573dce9c644f972_9.png)
- en: If you want to learn more about Profilr and see more examplesã€‚ please check
    out our Pror recipe on website Thank you very muchã€‚![](img/8ecf516795c50978f573dce9c644f972_11.png)
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äºProfilrçš„å†…å®¹å¹¶æŸ¥çœ‹æ›´å¤šç¤ºä¾‹ï¼Œè¯·æŸ¥çœ‹æˆ‘ä»¬ç½‘ç«™ä¸Šçš„Proré£Ÿè°±ï¼Œéå¸¸æ„Ÿè°¢ä½ ã€‚![](img/8ecf516795c50978f573dce9c644f972_11.png)
- en: '![](img/8ecf516795c50978f573dce9c644f972_12.png)'
  id: totrans-14
  prefs: []
  type: TYPE_IMG
  zh: '![](img/8ecf516795c50978f573dce9c644f972_12.png)'
