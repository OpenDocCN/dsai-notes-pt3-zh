# 面向初学者的 TensorFlow 教程，P4：L4- 线性回归  完整项目演练 

![](img/938d327f6471f60f92b4ed5bae0092f3_0.png)

🎼，大家好，欢迎来到下一个 TensorFlow 教程。在上一个视频中，我们学习了如何创建神经网络，然后训练和评估模型并进行预测。😊，在本教程中，我们实现我们的第一个真实世界项目，因此我们处理回归问题，学习如何加载数据。

分析数据并进行一些预处理。是的，正如我上次所说，我们已经使用了深度神经网络。这里我们先退一步，仅应用线性回归模型。所以只有一层。但最后，我们再次将其扩展为深度神经网络。通过这个，你应该能更好地理解 Keras 层。

还有激活函数。因此我在一个 Jupyter 笔记本中。你不需要担心这个，这只是让我在向你解释代码和展示不同步骤时生活更容易一点。但是你可以在普通的 Python 文件中编写所有这些代码。那么让我们开始，首先导入我们需要的东西。这里，我再次关闭了一些警告。然后我们导入 matplotlib。

这也是新的。因此现在我们使用 pandas。你可以通过 pip install pandas 来安装它。😊。这使得处理数据集、分析它们和修改它们变得非常简单。然后在这里我设置了一些打印选项，让输出看起来更好一些。接着我们从 TensorFlow 导入相关内容。所以再次导入 TensorFlow 的 tf，然后导入 Keras。

上次我告诉你关于 Kaas API 的事情，我们已经使用了 ks 层。现在这是新的。因此我们还从 TensorFlow 的 ks.layers 导入实验模块，导入 preprocessing 来对数据应用预处理层。这是我们需要的导入。现在开始处理数据集。

所以我们将使用这个 autompg 数据集。这个数据集来自1983年，这里有不同的特征，使用这些特征来预测汽车的 mpg。因此，汽车使用一加仑燃料能行驶多少英里，这里是一个非常流行的网站，你可以在上面找到很多机器学习数据集。如果你点击数据文件夹，下面你会找到实际数据的链接。

现在在这个 Jupyter 笔记本中，这是完全相同的 URL。我已经在上面写好了不同的列名，然后使用 pandas，我们可以说 pandas 能读取 CSV。因此这里的结尾不是 do csv，但它仍然是 CSV 格式的。所以我们可以使用这个方法，如果你在磁盘上有 CSV 文件，也可以使用这个方法。所以这也可以工作。现在让我们加载数据，然后可以调用 data.tail，这将打印最后五列。我们在这里看到想要预测的 mpg 值和不同的特征。

例如，我们有气缸数量、排量、马力、重量、加速度、车型年份等。因此，是的，这是我们的数据集，现在我们清理我们的数据集。在这里我们有一些缺失值，我们可以很简单地通过调用`data.drop`来排除它们，然后我们也会改变最后一列，因为。

这实际上是一个分类值，其他的都是数值型值。所以这可能会让我们的模型感到困惑。因此我们想将其转换为独热编码数据。我们可以调用数据集的`pop`方法或直接删除它。在原始数据中，我们有不同的国家，如美国、欧洲和日本。我们可以这样添加它们。现在，再次进行操作。

如果我们查看尾部数据，那么我们会看到我们移除了原始值，而是包含了独热编码标签。因此，对于标签1，代表美国；对于标签2，代表欧洲。然后，标签1又是这样。所以现在我们有了这个。现在我们想将数据分为训练集和测试集。我们可以通过调用`sample`方法，并在这里使用一个比例来实现。因此，使用80%作为训练集。

然后我们再次删除样本。因此，所有我们在这里指定的样本都不包括在测试集中。然后，是的，让我们打印形状，并描述我们的数据集，因此我们也可以通过调用`describe`函数很容易地做到这一点。然后在这里我们看到我们的整个数据集有392个样本，目前有10个不同的列。

然后我们的测试数据，训练数据占80%，即314，剩下的是用于测试的。现在如果我们调用描述函数，它会分析一些统计信息，如样本数量、均值、标准差、最小值和最大值。这可能有助于分析。首先，我们想要做的是将特征和标签分开。

我们想要的是我们的标签，以预测MP。首先我们做一个副本。因此，我们说这些是我们的训练特征和测试特征。然后我们简单地从训练和测试数据中删除MPG列。当我们这样做时，它也会返回数据。所以这就是我们现在的训练和测试标签。

现在我们有了这个。然后这是一个简单的函数，用于用`matplotlib`绘制数据。现在让我们简单地绘制一个特征。因此，让我们绘制马力特征。我们将其与MPg值进行对比。所以我们看到，汽车的马力越大，MPg值越低。这是有道理的，因为我们的汽车功率越大，所需的燃料也就越多。

所以MPg值越低。而且我们也可以绘制重量特征，这应该有类似的分布。因此，汽车的重量越大，消耗的燃料就越多，而MPg值则越低。所以，是的，这就是我们的数据呈现的样子。现在如果我们回到描述函数，查看不同的均值。

然后我们看到这些都有不同的范围，这再次是一个非常重要的问题，我们必须考虑。因此，如果我们这样保持这些不同的范围，可能会使我们的模型感到困惑。因此，建议先对数据进行标准化。让我们再次打印，描述我们的训练数据集，但只打印均值和标准差。

如果我们再次运行这个，那么这里我们会看到不同的均值。现在为了标准化，我们使用了预处理模块中的这个标准化层。因此这里是我们导入的这个。让我们编码这个。因此我们创建一个标准化层。因此我们说normalizer等于pre.processing.dot.Normalization。

这是一个适用于顺序API的kas层。要调用这个，我们必须将其适应我们的数据。因此这里我们说，normalizer.dot.adapt。然后我们想要将其适应训练特征。目前，这是一个pandas数据集，所以我们可以将其转换为nuy数组，然后调用训练特征。

所以现在这个功能的作用是，简单地计算训练特征的均值和方差，然后将其存储在层中。因此，现在，例如，我们可以打印，然后使用normalr.dot.mean.dot.nuy。如果我们运行这个，就可以看到这里。这些是我们的均值，这些数字与我们在第一列看到的完全相同。因此这只是将其存储下来。现在每当我们将这个层应用于我们的数据时。

它会对特征进行标准化，以计算这个公式。因此，它减去均值，然后除以标准差。这意味着我们的输出具有零均值和单位方差。这里我们来一些示例。因此，第一个数据来自训练特征。然后，让我们打印这个。

所以这是第一个数据标准化。然后我们还想打印标准化后的数据。因此，让我们打印nor.Maized。然后这里我们需要用我们的数据调用这个normalr层。所以首先。然后将其转换为numpy。这是我们如何将TensorFlow张量转换为nuy数组。让我们运行这个。然后我们看到我们有第一层具有不同的尺度和范围。

现在我们的标准化数据。因此它们都在0附近，具有单位标准差。这就是我们如何应用标准化预处理层。现在让我们处理我们的回归问题。在回归中。我们在某处有这个从训练数据得知的分布。

现在当我们获得新数据时，我们想要，例如。这里我们获得一个新的权重样本，然后我们想预测这辆车的多少mpT。为此，我们拟合一个函数，即用这个公式拟合一个线性函数，这样我们可以用mp乘以x加上B来近似。因此，这基本上是一个线性方程，我们使用这个与密集层一起。

为了更好地理解这一点。现在，首先，让我们不要使用所有不同的训练特征。所以这些，让我们只使用一个，以便保持在二维情况下。在这种情况下，例如，使用马力。所以在这里让我们定义我们的特征，这应该是马力标签。我将这样实现，这样您就可以在这里更改特征，然后尝试不同的特征。

在这里使用权重，所以所有这些名称都可以作为特征使用。现在让我们获取单特征或单数据，称之为单特征等于Ny数组。从我们的训练特征中，然后我们可以通过特征访问它。这将只返回马力特征。所以让我们打印这个。打印单特征 dot shape。打印训练特征 dot shape。

所以现在，如果我们运行这个。嗯。这里我有一个拼写错误的数组。让我们再运行一次。然后我们看到我们的单特征只有一个特征。而在整个训练数据中，我们有9个不同的特征。然后在这里，我们创建了这个预处理或归一化层，并将其适应于所有特征。所以基本上我们必须做同样的事情，但现在仅适应马力特征。

所以我们再次称之为单特征归一化器，我们调用适应数据并适应单特征单下划线特征。所以现在我们有这个，可以运行这段代码，这里我有一个多余的括号。所以再次修正。所以现在我们有这个单特征。现在我们创建我们的顺序模型，就像上次一样。

所以使用Kaas API非常简单。嗯。所以，我们说，我们的单特征模型等于。然后我们说，Kas dot Models dot sequential。在这里我们使用一个包含所有不同层的列表。所以我们将这个作为第一层。单特征归一化器。然后我们只使用一层。所以一个密集层，输出或称为单位数的单位只有一个。

所以这就是我们构建线性回归模型所需的全部。这是一个线性回归或线性模型，完全应用这个公式。它有一些权重，并将其与我们的输入相乘。它还有一个偏置。所以这就是我们在这里所做的一切。让我们运行这个，并打印模型摘要。

然后我们看到有归一化层和密集层，只有五个参数。5个参数。所以这非常简单。接下来，和上次一样，我们定义一个损失和一个优化器。所以对于损失，我们使用ks dot losses。在线性回归的情况下，我们可以使用平均绝对误差。

所以这是一种可能性，我们也可以使用均方误差。所以你可以尝试两者。😊。所以这实际上是预测值y减去实际值y，然后取绝对值，最后对所有样本求和，计算均值，均方误差是相同的，只不过这里使用的是平方而不是绝对值。

所以试试看吧。现在优化器等于。所以和上次一样Kaas.dot.optimizers.dot。让我们使用Adam优化器。我们需要给它一个学习率。让我们试试0.1。然后在我们有了这个之后，我们编译我们的模型。所以单特征模型.dot.compile，compile。在这里我们给它。

优化器等于优化器和。损失等于损失。是的。上次我们也给了它要跟踪的指标，所以准确率。但在回归中准确率没有意义，所以我们不考虑。然后我们可以稍后看到损失。让我们运行这个。现在来训练模型。

我们只需像上次那样调用model.dot.fit，使用我们的训练特征，这里我们只希望定义的单个特征，所以在这种情况下是马力。但我们仍然包括所有训练标签，然后定义周期，在这里我将verbose设置为1以查看一些日志，我们还可以定义验证分割，这样自动将20%的训练数据用于验证数据，以调整超参数。

所以让我们训练我们的模型。现在，训练完成了。现在我们看到损失减少了，我们也看到验证损失在减少。最后，我们的训练损失是3.8，验证损失稍微超过4.1。所以并不算太差。顺便说一句，如果我们调用model.fit，那么它将返回历史记录，其中存储了这两个损失。

所以我们可以将其分配给一个变量，我在这里称之为history。然后我简单地绘制历史记录。接着，我们可以通过调用history.dot.history来访问这两个损失，然后访问损失和验证损失。让我们绘制这个，然后我们可以看到损失减少了，看起来非常不错。然后要评估我们的模型，我们就像上次一样简单进行。

调用model.dot.evaluate，只用我们的测试特征，即马力和测试标签。让我们运行这个。这非常快。所以在这里我们看到。测试数据的最终损失为3.6。所以并不算太差。现在让我们预测一些样本。因此在这种情况下，我简单创建了测试数据。所有值在。

最小值和最大值之间，并增加范围一点。你也可以在这里直接使用一个硬编码的数字，比如从0到250。但我想让它更适合使用的特征。所以我们使用这个。然后要进行预测，我们调用model.dot.predict。然后是我们想要预测的新测试数据。

然后我们用一开始的函数绘制它。这与一开始的图相同。因此我们绘制马力与MP7值的关系。这些是我们预测的新x值。我们看到我们的预测。因此在这里我们绘制一条线。这是一条线性线，因为我们使用的是线性回归模型。

我们看到情况还不错。因此，我们看到相同的趋势。我们的汽车马力越大，MP越低。但是，例如，在这个区域，除非我们的马力进一步增加，否则它保持不变。所以是的，在这个区域，也许在这个区域，它并不完美。但是在其余部分。

看起来还不错。所以，是的，这就是我们如何应用线性模型。再一次，我们只需要一个带有一个输出单元的密集层。我们还应用这个归一化层。因此，这就是我们进行线性回归所需的一切。现在让我们将其扩展为深度神经网络。正如我所说，只有一个密集层。

我们这里只能使用一个线性函数，这并不完美。因此，为了进一步改善，我们可以在这里引入更多层，将其转换为一个完全前馈的神经网络。所以我们简单地，仍然在最后使用归一化层和密集层。但是在中间，我们使用更多的密集层。假设，layers.dot.dense。

然后在这里你可以尝试不同的隐藏层大小。正如我上次所说，我们还对中间这些层应用激活函数。😊，所以我们是的，让我们像上次一样再用一次relu。然后我们再使用同样的。是的，然后在最后，我们用一个输出的密集层。现在这就是我们所需要的全部。

现在我们将我们的线性回归模型转换为深度神经网络模型。所以让我们使用这个。然后再次，我们用损失和一个adam优化器进行编译，并调用摘要以再次查看不同的层。然后我们看到现在有很多参数需要训练。因此现在再次。

让我们用我们的马力特征调用模型拟合并开始训练。😊，训练完成。我们看到最终模型或最终损失现在略微改善，所以比之前略低。让我们评估一下我们的模型。现在它低于三。因此它肯定更好。现在我们再做一些预测并绘制图表。现在我们看到一个新图。

现在我们看到我们的函数不再只是线性。但在这里我们也有一些非线性区域。😊，这是我们所使用的激活函数的效果。这就是为什么在神经网络中应用激活函数如此重要。因此在这里，我们再次只有一个带有一个密集层的线性回归模型。

在这里我们只能预测线性函数。而现在通过深度神经网络，我们可以获得非线性函数作为预测。所以是的。我想这就是全部，现在我们只使用一个特征，以便保持在这个二维案例中，但当然，我们可以包括所有特征，方式相同。

所以实际上我们不需要更改任何东西。我们使用这个标准化器，将其调整到所有的主要特征。在这里，我们只有一个密集层。然后我们编译它。接着我们将其拟合到所有训练特征上进行训练。现在，训练完成。我们看到损失也低于3。因此，使用所有特征进行训练效果很好。

此外，更好。现在让我们将其评估为最后一件事情。然后我们看到最终的损失。所以是的，你会看到代码实际上是相同的。我们只是在这里使用所有的训练特征，以及标准化器。我们将其调整到所有训练特征。因此，是的。

我想你现在在这个教程中学到了很多，关于如何下载和加载CSV数据，如何用pandas框架分析和预处理它，然后如何使用标准化层来标准化我们的数据，接着如何用这个密集层设置一个线性回归模型。

然后再次，训练和评估与上次相同。是的，我们也。你了解了激活函数在深度神经网络中的作用。就这样，今天到此为止。希望你喜欢这个教程。如果你喜欢，请点击赞按钮，并考虑订阅频道。

希望在下一个视频见到你，再见。😊！[](img/938d327f6471f60f92b4ed5bae0092f3_2.png)
