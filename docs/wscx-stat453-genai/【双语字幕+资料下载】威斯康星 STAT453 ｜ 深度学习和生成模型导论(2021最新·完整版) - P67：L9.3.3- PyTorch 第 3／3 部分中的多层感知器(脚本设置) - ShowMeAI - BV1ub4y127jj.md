# „ÄêÂèåËØ≠Â≠óÂπï+ËµÑÊñô‰∏ãËΩΩ„ÄëÂ®ÅÊñØÂ∫∑Êòü STAT453 ÔΩú Ê∑±Â∫¶Â≠¶‰π†ÂíåÁîüÊàêÊ®°ÂûãÂØºËÆ∫(2021ÊúÄÊñ∞¬∑ÂÆåÊï¥Áâà) - P67ÔºöL9.3.3- PyTorch Á¨¨ 3Ôºè3 ÈÉ®ÂàÜ‰∏≠ÁöÑÂ§öÂ±ÇÊÑüÁü•Âô®(ËÑöÊú¨ËÆæÁΩÆ) - ShowMeAI - BV1ub4y127jj

YeahÔºå let's start by taking a look at the results from the previous run„ÄÇSoÔºå as we can see„ÄÇ

It finished after approximately 4 minutesÔºå as we can seeÔºå yeahÔºå the loss looks nice„ÄÇ It goes down„ÄÇ

 so you can see„ÄÇFor the different epochsÔºå the loss continually„ÄÇGoes down„ÄÇ

 Maybe training a little bit longer would have been nice because we can see there's still a trend here„ÄÇ

 But overallÔºå that looks pretty good„ÄÇAnd then alsoÔºå when we compute the accuracy„ÄÇ

 we get a good accuracy here„ÄÇNowÔºå let me show you how I would organize my code if I work on a bigger project where I do more tuning„ÄÇ



![](img/b6d69566a43e53c76bb416d3aee91911_1.png)

So what I like to do is I like to do like to use Pi scripts for that So if I have a folder here I have usually multiple files„ÄÇ

 one helper do pi file sometimes also multiple helper files where I keep functions that I want to reuse yeah across different projects but also if I have multiple models I keep like general functions in there for example„ÄÇ

 computing the accuracy would be such a function and I also have a settings file with model settings and hyperpar settings and so forth and then the main train model file which is yeah used for training the model„ÄÇ

So let's open them and take a look„ÄÇ

![](img/b6d69566a43e53c76bb416d3aee91911_3.png)

So I'm opening them here in visual studio code„ÄÇ What I really like about Vi studio code is that it's fast and also shows me if I make errors„ÄÇ

 for example„ÄÇ So if IÔºå let's say„ÄÇI don't know„ÄÇ Let's say I make a typo here„ÄÇ

 I type FLSE set of faults„ÄÇ It would tell me undefined name„ÄÇ So it's quite smart„ÄÇ

 It will find out if I have something that is not defined„ÄÇSo that's what I like about it„ÄÇ

 So it's easy to quickly find typos to yeah debu your code„ÄÇ So starting withÔºå let's say„ÄÇ

 starting with a train model file„ÄÇ So the train model file here is„ÄÇImporting from the helper file„ÄÇ

 So there are general functionsÔºå like I mentioned„ÄÇ So I'm importing the data loads and functions for setting the random seeds and making everything deterministic„ÄÇ

 ImÔºå This is something I'm using in many different projects„ÄÇ So I'm keeping this in my general file„ÄÇ

And also things like computing the accuracy and plotting the training laws and accuracy and so forth„ÄÇ

 So that's something I like to reuse in other projects or if I have multiple train model files„ÄÇ

 let's say train model MLLP1 and train model MLP2 and so forthÔºå I can reuse that code„ÄÇ

 I don't have to copy and paste it every time„ÄÇOther things here is I'm also setting it up such that it yeah that it can read command line arguments„ÄÇ

 I will show you how to run this in a second„ÄÇ but hereÔºå for example„ÄÇ

 I'm setting it up with this argument Pa that it accepts one argument called settings dot path and one results dot path„ÄÇ

 So here this is where it finds the hyperpar settings and model settings„ÄÇ

 And here's where it's putting the log files and results from that run„ÄÇ

 So my settings file I'm using Yal„ÄÇSo Yaml is think it stands for yet another markdown language or mark markup language„ÄÇ

 so„ÄÇBut that means it's just a simple way of of writing a text file that is human readable„ÄÇ

 So here's my Yal file„ÄÇ And there's actually„ÄÇPython library called P Yal„ÄÇ

 which lets you load these Yal files„ÄÇ I'm doing it here„ÄÇ So if I'm loading it like thisÔºå then„ÄÇ

Settings will be a Python dictionary„ÄÇ So it's loading the yaml file into a Python dictionary that I can use„ÄÇ

 So why am I doing that It's just for organizing things so„ÄÇI couldÔºå for example„ÄÇ

 have multiple settings filesÔºå and each one has a different hyperparmeter setting„ÄÇ

 and then I can keep everything organized by having these files„ÄÇButÔºå of course„ÄÇ

 you can always or put everything„ÄÇ It could put the settings„ÄÇAlsoÔºå instead of using the Yaml file„ÄÇ

 I couldÔºå of courseÔºå also write up„ÄÇPython Dictionary here„ÄÇAnd thenÔºå yeahÔºå you would have to„ÄÇ

At the strings and then chromas and so forth„ÄÇ So you could alsoÔºå of course do do that„ÄÇ

 But if you have bigger projectsÔºå it might be helpful to organize things this way„ÄÇ

 because then you have maybe multiple settings files that you want to set up and run in parallel or something like that„ÄÇ

Here I'm using a trick„ÄÇ So toÔºå how can I say thatÔºå So usually I like to print things to the command line when I run my script„ÄÇ

But alsoÔºå I want to keep a record of it later on that I can take a look at„ÄÇ So here„ÄÇ

This is like a trick so that you can see the output on the command lineÔºå but also„ÄÇ

 it will be written to a file„ÄÇSo everything I print„ÄÇ

 this will also be written to a file called training do lockÔºå which will be in the results path„ÄÇ

So I'm going over this rather quicklyÔºå but if you have any questions„ÄÇ

 let me know Also this is nothing you have to know for the exam or anything„ÄÇ

 I'm just showing it to you and sharing it with you because I think it could be helpful for your project if you are using Google Colllap it may be easier to have everything in a single notebook but I think in general if you are organizing your projects on your computer it might be helpful also sometimes to use these scripts files before you run them on in a notebook„ÄÇ

So„ÄÇYeahÔºå so going down hereÔºå just printing some output for logging purposes that I'm using my set deterministic function from my helper file that I imported earlier„ÄÇ

 This makes my code run deministically„ÄÇ That means if I run it again„ÄÇ

 I will get exactly the same results„ÄÇ Now also the data load I'm loading here„ÄÇ so„ÄÇIt'sÔºå I think„ÄÇ

 more convenient because it's a lot of code to put this into a separate file„ÄÇ If I go here again„ÄÇ

 So the data load up„ÄÇI think I put it on the bottom here„ÄÇ It's actually a pretty big code chunk„ÄÇ

 so I'm just writing it here and then reuse that in my different projects when I use Mnes so I don't have to always put all the code into this file„ÄÇ

 I just have to copy and paste my helper file„ÄÇAlright„ÄÇ

 so here this is now how I provide the hyperparmeter because settings is a dictionary„ÄÇ

 It has the dictionary entries corresponding to these entries here„ÄÇ So there's a batch size„ÄÇ

So I am passingÔºå so I'm not hard coding these values„ÄÇ They are all read from the settings files„ÄÇ

 So if I change my settings filesÔºå I don't have toÔºå I never have to modify train model„ÄÇ

 So I never have to really touch that„ÄÇ I can yet do a hyper tuning by just changing this only this one single file„ÄÇ

All rightÔºå so then there's my multide hypoceptron here„ÄÇ

Just the regular training using a different I use atom here„ÄÇ I just seeÔºå could also use S GD„ÄÇ

 We will be„ÄÇTalking about Adam in a future lectureÔºå it's like a slightly improved version of SGG„ÄÇ

YeahÔºå and then this is just„ÄÇThe whole code I used also in the previous notebooks„ÄÇ And then yeah„ÄÇ

 I have a plotting function for plotting the loss and the accuracy„ÄÇ Again„ÄÇ

 you don't have to know all these details„ÄÇ It's just can copy and paste that from my code„ÄÇ

 It's usually just something„ÄÇ YeahÔºå it's it's more like software engineering at that point„ÄÇYeah„ÄÇ

 I also just for bookkeepingÔºå I create a results dictionaryÔºå so here I keep the training aacies„ÄÇ

 the abl aaciesÔºå the final test set accuracy„ÄÇAnd also the settings for also bookkeeping„ÄÇ

 So if I want to look that up laterÔºå I have a record of that„ÄÇ SoÔºå for example„ÄÇ

 let's say you run your modelÔºå but later onÔºå you decide you want to make some different plots This way„ÄÇ

 you don't have to rerun your model„ÄÇ You have all your data here„ÄÇAnd I am saving that to a yaml file„ÄÇ

AlrightÔºå so let's run this then and see how it works„ÄÇ



![](img/b6d69566a43e53c76bb416d3aee91911_5.png)

So here I'm in this folder„ÄÇ and if I want to run thisÔºå I type a Python train model not Py„ÄÇ

 and then remember there are two arguments„ÄÇ I can maybe try to run without it should complain„ÄÇYeah„ÄÇ

 it says following arguments are required settings path and results path„ÄÇ So just to show you„ÄÇ

 let me show you the results„ÄÇ you can see it's empty right now„ÄÇNow I'm executing itÔºå Python„ÄÇ

Train modelÔºå giving it the settings„ÄÇPas„ÄÇJust called it settings that„ÄÇYmo„ÄÇ

 so this is just this file hereÔºå and then results„ÄÇPath„ÄÇJust call it results„ÄÇ



![](img/b6d69566a43e53c76bb416d3aee91911_7.png)

So then it's running„ÄÇAnd you can see while it is runningÔºå it's putting things here„ÄÇ

 but it's already also putting a log file here so you can either check the command line here„ÄÇ

Or you can or if you don't haveÔºå let's sayÔºå if you are on the server and you don't have a stable connection and this gets interrupted„ÄÇ

 then you still have this log file here„ÄÇOkayÔºå already we finished it was pretty quick„ÄÇ

 So now everything we have seen is in this log file here as well„ÄÇ So just for records„ÄÇ

 for future recordÔºå if you close this session hereÔºå you will have it still available„ÄÇ

Then we have our plots here that we generated„ÄÇ So this is„ÄÇA slightly fancier version of yeah„ÄÇ

 the mini Bchelors„ÄÇ So here I am computing the running average„ÄÇAnd„ÄÇYeah„ÄÇ

 this is on the left hand sideÔºå the training and validation accuracy„ÄÇFor the different epochs„ÄÇ

 for the 10 epochs„ÄÇYeahÔºå and I have that now for my records and I also have this results dictionary if I want to create new plots„ÄÇ

 so this is also a Yamal file with settingsÔºå the final test that accuracy„ÄÇ

The training acricacies and validation aricacies„ÄÇ

![](img/b6d69566a43e53c76bb416d3aee91911_9.png)

Of courseÔºå if you have let's say you have a Jupyter notebookÔºå youÔºå it's sometimes more convenient„ÄÇ

 for exampleÔºå if you on Google callllab to have everything in a single file„ÄÇ

 but there is also a way you can do a hybrid of that„ÄÇ So if I go into this directly„ÄÇ

 let me just create a new„ÄÇJupiterocÔºå for exampleÔºå like hereÔºå it's a new Jupyter notebookoc„ÄÇ

 I can also„ÄÇMaybe don't have to use the Yaml file„ÄÇButÔºå I could also„ÄÇ



![](img/b6d69566a43e53c76bb416d3aee91911_11.png)

„ÄÇI close these filesÔºå one second„ÄÇ

![](img/b6d69566a43e53c76bb416d3aee91911_13.png)

I could also import for my helper fileÔºå so„ÄÇüòî„ÄÇ

![](img/b6d69566a43e53c76bb416d3aee91911_15.png)

When I haveÔºå for exampleÔºå here these imports from help import„ÄÇ

 I can do the same thing also with my Jupyter notebook„ÄÇ I can also import here and see„ÄÇ So only„ÄÇ

 the only thing I have to do is I have to have the helper file in the same folder as the Jupyter notebook„ÄÇ

 But that wayÔºå you can keep your„ÄÇ

![](img/b6d69566a43e53c76bb416d3aee91911_17.png)

![](img/b6d69566a43e53c76bb416d3aee91911_18.png)

Jupiter notebook box rather small„ÄÇ You don't have to make them huge so you can technically„ÄÇ

 you could also„ÄÇ

![](img/b6d69566a43e53c76bb416d3aee91911_20.png)

Copy and paste this„ÄÇ You have to make some modifications because we don't have these„ÄÇArguments„ÄÇ

 but we couldÔºå as it say„ÄÇYeahÔºå Arc's result path„ÄÇ YeahÔºå the problem would beÔºå we had„ÄÇ

 we would have to change„ÄÇThis one to result path„ÄÇYou could do it like this„ÄÇ

And then let's say results„ÄÇAnd then„ÄÇsettingstting„ÄÇLike this„ÄÇ And then we have to remove this arc„ÄÇ

HereÔºå everywhere„ÄÇSo how I can maybe quickly do that is by„ÄÇMaking a new text file„ÄÇThenÔºå replace arc„ÄÇ

Dot actuallyÔºå I don't know how this works here„ÄÇ OkayÔºå I wÔºå maybe I can do that in quick„ÄÇ

 more quickly here„ÄÇ

![](img/b6d69566a43e53c76bb416d3aee91911_22.png)

A that„ÄÇJust replacing every instance of worksrcs„ÄÇLike this„ÄÇ



![](img/b6d69566a43e53c76bb416d3aee91911_24.png)

And then„ÄÇCing it back„ÄÇHere„ÄÇÂóØ„ÄÇYeahÔºå that should technically work„ÄÇ as will probably complain„ÄÇ

 I've probably forgot something here„ÄÇNo it actually works„ÄÇYeah„ÄÇ

 so we could also run the code then in the Jupyter notebook here if we wanted to„ÄÇ

 So note that we saved some space by not putting these functions from the helper functions into this notebook„ÄÇ

 So it's a little bit shorter„ÄÇ So this way you can also yeah take advantage of that on Google call„ÄÇ

 AllrightÔºå so this is it for the coding examples„ÄÇ I will upload them all to Github so you can take a closer look„ÄÇ

 and then we will continue with some aspects about multilayer perceptrons„ÄÇ



![](img/b6d69566a43e53c76bb416d3aee91911_26.png)